import{i as O,a as q,r as i,j as e,c as U,B as c,D as H,d as j,S as V,g as G,f as T,h as Y,C as Z,e as b}from"./index-CW7sJ-MG.js";import{B as L}from"./badge-D5WoGv9G.js";import{D as J}from"./download-ExawylnA.js";import{T as K}from"./trending-up-DTQPjW96.js";import{F as Q}from"./funnel-DV1gsmvk.js";import{C as $}from"./calendar-C6BTQIk3.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]],X=O("file-spreadsheet",W),re=()=>{const{currentUser:r}=q(s=>s.user),[x,E]=i.useState([]),[M,y]=i.useState(!1),[S,D]=i.useState(null),[g,I]=i.useState(""),[k,B]=i.useState(!1),[a,F]=i.useState({period:"all",minAmount:"",maxAmount:"",startDate:"",endDate:""}),[n,u]=i.useState({page:1,limit:10,totalSales:0,totalPages:1}),[N,R]=i.useState({totalSales:0,averageSale:0,saleCount:0}),[v,C]=i.useState(!1);i.useEffect(()=>{r?(async()=>{try{y(!0);const t=new URLSearchParams({page:n.page,limit:n.limit});g&&t.append("search",g),a.period!=="all"&&t.append("period",a.period),a.minAmount&&t.append("minAmount",a.minAmount),a.maxAmount&&t.append("maxAmount",a.maxAmount),a.startDate&&t.append("startDate",a.startDate),a.endDate&&t.append("endDate",a.endDate);const h={"Content-Type":"application/json",...(r==null?void 0:r.token)&&{Authorization:`Bearer ${r.token}`}},l=await fetch(`/api/route/sales?${t.toString()}`,{headers:h});if(!l.ok)throw new Error(`HTTP error ${l.status}: ${l.statusText}`);const d=await l.json();if(!d)throw new Error(d.message||"Failed to fetch sales data");const w=[...d.sales].sort((p,f)=>new Date(f.date)-new Date(p.date));E(w),R(d.summary),u(p=>({...p,totalSales:d.totalSales,totalPages:d.totalPages}))}catch(t){D(t.message),b.error(t.message)}finally{y(!1)}})():(D("No user found. Please ensure you are logged in."),y(!1))},[n.page,n.limit,g,a,r]);const _=s=>{s.preventDefault(),u({...n,page:1})},m=s=>{const{name:t,value:h}=s.target;F(l=>({...l,[t]:h})),u({...n,page:1})},A=s=>{s>=1&&s<=n.totalPages&&u({...n,page:s})},P=async(s="excel")=>{try{C(!0);const t=new URLSearchParams({format:s});a.period!=="all"&&t.append("period",a.period),a.startDate&&t.append("startDate",a.startDate),a.endDate&&t.append("endDate",a.endDate);const h={"Content-Type":"application/json",Accept:s==="excel"?"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"text/csv",...(r==null?void 0:r.token)&&{Authorization:`Bearer ${r.token}`}},l=await fetch(`/api/route/analytics/admin/sales-report?${t.toString()}`,{headers:h,method:"GET"});if(!l.ok)throw new Error(`HTTP error ${l.status}: ${l.statusText}`);const d=await l.blob(),w=s==="excel"?"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"text/csv",p=new Blob([d],{type:w}),f=window.URL.createObjectURL(p),o=document.createElement("a");o.style.display="none",o.href=f;const z=new Date().toISOString().split("T")[0];o.download=`sales_report_${z}.${s==="excel"?"xlsx":"csv"}`,document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(f),document.body.removeChild(o),b.success("Sales report downloaded successfully")}catch(t){console.error("Download error:",t),b.error(`Failed to download report: ${t.message}`)}finally{C(!1)}};return M&&x.length===0?e.jsx(U,{}):e.jsxs("div",{className:"bg-gray-50 min-h-screen p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Sales Management"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(c,{onClick:()=>P("excel"),disabled:v,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),v?"Downloading...":"Export to Excel"]}),e.jsxs(c,{onClick:()=>P("csv"),disabled:v,variant:"outline",className:"border-green-600 text-green-600 hover:bg-green-50",children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"CSV"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-md p-6 hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 bg-orange-100 rounded-lg p-3",children:e.jsx(H,{className:"h-8 w-8 text-orange-500"})}),e.jsxs("div",{className:"ml-5",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Sales"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:j(N.totalSales)})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-md p-6 hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 bg-orange-100 rounded-lg p-3",children:e.jsx(K,{className:"h-8 w-8 text-orange-500"})}),e.jsxs("div",{className:"ml-5",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Average Sale"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:j(N.averageSale)})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-md p-6 hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 bg-orange-100 rounded-lg p-3",children:e.jsx(V,{className:"h-8 w-8 text-orange-500"})}),e.jsxs("div",{className:"ml-5",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Sale Count"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:N.saleCount})]})]})})]}),e.jsxs("form",{onSubmit:_,className:"mb-6",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",value:g,onChange:s=>I(s.target.value),placeholder:"Search sales...",className:"flex-1 p-2 border rounded"}),e.jsx(c,{type:"submit",children:e.jsx(G,{size:20})}),e.jsx(c,{type:"button",onClick:()=>B(!k),children:e.jsx(Q,{size:20})})]}),k&&e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("select",{name:"period",value:a.period,onChange:m,className:"p-2 border rounded",children:[e.jsx("option",{value:"all",children:"All Periods"}),e.jsx("option",{value:"daily",children:"Today"}),e.jsx("option",{value:"weekly",children:"Last 7 Days"}),e.jsx("option",{value:"monthly",children:"Last 30 Days"}),e.jsx("option",{value:"yearly",children:"Last Year"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm text-gray-600 mb-1",children:"Min Amount"}),e.jsx("input",{name:"minAmount",value:a.minAmount,onChange:m,placeholder:"Min Amount",className:"p-2 border rounded",type:"number"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm text-gray-600 mb-1",children:"Max Amount"}),e.jsx("input",{name:"maxAmount",value:a.maxAmount,onChange:m,placeholder:"Max Amount",className:"p-2 border rounded",type:"number"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm text-gray-600 mb-1",children:"Start Date"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx($,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"date",name:"startDate",value:a.startDate,onChange:m,className:"pl-10 p-2 border rounded w-full"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm text-gray-600 mb-1",children:"End Date"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx($,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"date",name:"endDate",value:a.endDate,onChange:m,className:"pl-10 p-2 border rounded w-full"})]})]})]})]}),S&&e.jsx("div",{className:"text-red-500 mb-4",children:S}),e.jsxs("div",{className:"bg-white rounded-xl shadow-md overflow-hidden",children:[e.jsx("div",{className:"hidden sm:block overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Order ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Items"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No sales found matching your criteria"})}):x.map(s=>{var t;return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:T(s.date)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-orange-600",children:s._id}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:((t=s.customer)==null?void 0:t.name)||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:j(s.amount)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.items}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(L,{className:`${s.status==="delivered"?"bg-green-100 text-green-800":s.status==="pending"?"bg-yellow-100 text-yellow-800":s.status==="cancelled"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:s.status})})]},s._id)})})]})}),e.jsx("div",{className:"sm:hidden p-4",children:e.jsx("div",{className:"grid grid-cols-1 gap-4",children:x.length===0?e.jsx("div",{className:"text-center text-sm text-gray-500 p-4",children:"No sales found matching your criteria"}):x.map(s=>{var t;return e.jsx("div",{className:"bg-white p-4 rounded-lg shadow hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Date"}),e.jsx("span",{className:"text-xs font-semibold",children:T(s.date)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Order ID"}),e.jsx("span",{className:"text-xs font-semibold text-orange-600",children:s._id})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Customer"}),e.jsx("span",{className:"text-xs font-semibold",children:((t=s.customer)==null?void 0:t.name)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Amount"}),e.jsx("span",{className:"text-xs font-semibold",children:j(s.amount)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Items"}),e.jsx("span",{className:"text-xs font-semibold",children:s.items})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Status"}),e.jsx(L,{className:`text-xs ${s.status==="delivered"?"bg-green-100 text-green-800":s.status==="pending"?"bg-yellow-100 text-yellow-800":s.status==="cancelled"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:s.status})]})]})},s._id)})})})]}),n.totalPages>1&&e.jsxs("div",{className:"flex justify-between mt-4",children:[e.jsx(c,{onClick:()=>A(n.page-1),disabled:n.page===1,variant:"outline",children:e.jsx(Y,{})}),e.jsxs("span",{children:["Page ",n.page," of ",n.totalPages]}),e.jsx(c,{onClick:()=>A(n.page+1),disabled:n.page===n.totalPages,variant:"outline",children:e.jsx(Z,{})})]})]})};export{re as default};
