import{a0 as L,A as _,r as c,j as e,c as A,L as C,a1 as E,l as I,a6 as P}from"./index-CW7sJ-MG.js";import{L as $}from"./loader-BXkacTqF.js";async function B(o){if(o==="new")return{_id:"",categoryName:"",slug:"",description:"",image:"",parent:"",featured:!1,status:"active"};const i=localStorage.getItem("token"),s=await fetch(`/api/route/categories/${o}`,{headers:{Authorization:`Bearer ${i}`}});if(!s.ok)throw new Error("Failed to fetch category");return await s.json()}async function D(){const o=localStorage.getItem("token"),i=await fetch("/api/route/allcategories",{headers:{Authorization:`Bearer ${o}`}});if(!i.ok)throw new Error("Failed to fetch parent categories");return(await i.json()).allCategory||[]}async function T(o,i,s){const a=localStorage.getItem("token"),m={...o},u=i?"/api/route/categories":`/api/route/update-categories/${s}`,g=await fetch(u,{method:i?"POST":"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(m)});if(!g.ok)throw new Error("Failed to save category");return await g.json()}const O=()=>{const{id:o="new"}=L(),i=_(),s=o==="new",[a,m]=c.useState({_id:"",categoryName:"",slug:"",description:"",parent:"",featured:!1,status:"active"}),[u,y]=c.useState([]),[g,p]=c.useState(!0),[j,N]=c.useState(!1),[b,l]=c.useState(null),[v,k]=c.useState("");c.useEffect(()=>{(async()=>{var t;try{p(!0),l(null);const r=await B(o);m({_id:r._id||"",categoryName:r.categoryName||"",slug:r.slug||"",description:r.description||"",parent:((t=r.parent)==null?void 0:t._id)||"",featured:r.featured??!1,status:r.status||"active"});const h=await D();y(h.filter(f=>{var x,w;return((x=f._id)==null?void 0:x.toString())!==((w=r._id)==null?void 0:w.toString())}))}catch{l("Failed to load category data. Please try again.")}finally{p(!1)}})()},[o]);const d=n=>{const{name:t,value:r,type:h,checked:f}=n.target;m(x=>({...x,[t]:h==="checkbox"?f:r}))},S=()=>{if(!a.categoryName)return;const n=a.categoryName.toLowerCase().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"");m(t=>({...t,slug:n}))},F=async n=>{if(n.preventDefault(),!a.categoryName){l("Category name is required");return}try{N(!0),l(null);const t=await T(a,s,a._id);t.success?(k(t.message),setTimeout(()=>{i("/admin/categories")},2e3)):l(t.message||"Failed to save category")}catch{l("An error occurred while saving the category")}finally{N(!1)}};return g?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx(A,{size:"lg"})}):e.jsx("div",{className:"bg-gray-50 min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(C,{to:"/admin/categories",className:"mr-4 text-gray-500 hover:text-gray-700",children:e.jsx(E,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-2xl font-bold leading-7 text-gray-900 sm:text-3xl sm:truncate",children:s?"Add New Category":"Edit Category"})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:s?"Create a new product category":"Update an existing product category"})]}),v&&e.jsx("div",{className:"mb-4 bg-green-50 border-l-4 border-green-400 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(I,{className:"h-5 w-5 text-green-400"})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-green-700",children:v})})]})}),b&&e.jsx("div",{className:"mb-4 bg-red-50 border-l-4 border-red-400 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(P,{className:"h-5 w-5 text-red-400"})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-700",children:b})})]})}),e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:e.jsxs("form",{onSubmit:F,children:[e.jsxs("div",{className:"border-b border-gray-200 px-4 py-5 sm:px-6",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Category Information"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Basic information about the category"})]}),e.jsx("div",{className:"px-4 py-5 sm:p-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-6",children:[e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Category Name *"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{type:"text",name:"categoryName",id:"name",value:a.categoryName,onChange:d,className:"shadow-sm focus:ring-orange-500 focus:border-orange-500 block w-full sm:text-sm border-gray-300 rounded-md",required:!0})})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"slug",className:"block text-sm font-medium text-gray-700",children:"Slug"}),e.jsxs("div",{className:"mt-1 flex rounded-md shadow-sm",children:[e.jsx("input",{type:"text",name:"slug",id:"slug",value:a.slug,onChange:d,className:"flex-1 focus:ring-orange-500 focus:border-orange-500 block w-full min-w-0 rounded-md sm:text-sm border-gray-300"}),e.jsx("button",{type:"button",onClick:S,className:"ml-3 inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500",children:"Generate"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Used in URLs. Leave empty to auto-generate from name."})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"parent",className:"block text-sm font-medium text-gray-700",children:"Parent Category"}),e.jsx("div",{className:"mt-1",children:e.jsxs("select",{id:"parent",name:"parent",value:a.parent,onChange:d,className:"shadow-sm focus:ring-orange-500 focus:border-orange-500 block w-full sm:text-sm border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"None (Top Level Category)"}),u.map(n=>e.jsx("option",{value:n._id,children:n.categoryName},n._id))]})}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Optional. Select a parent category if this is a subcategory."})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Status"}),e.jsx("div",{className:"mt-1",children:e.jsxs("select",{id:"status",name:"status",value:a.status,onChange:d,className:"shadow-sm focus:ring-orange-500 focus:border-orange-500 block w-full sm:text-sm border-gray-300 rounded-md",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("div",{className:"mt-1",children:e.jsx("textarea",{id:"description",name:"description",rows:3,value:a.description,onChange:d,className:"shadow-sm focus:ring-orange-500 focus:border-orange-500 block w-full sm:text-sm border-gray-300 rounded-md"})}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Brief description of the category."})]}),e.jsx("div",{className:"sm:col-span-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex items-center h-5",children:e.jsx("input",{id:"featured",name:"featured",type:"checkbox",checked:a.featured,onChange:d,className:"focus:ring-orange-500 h-4 w-4 text-orange-600 border-gray-300 rounded"})}),e.jsxs("div",{className:"ml-3 text-sm",children:[e.jsx("label",{htmlFor:"featured",className:"font-medium text-gray-700",children:"Featured Category"}),e.jsx("p",{className:"text-gray-500",children:"Featured categories are prominently displayed on the homepage and category listings."})]})]})})]})}),e.jsxs("div",{className:"px-4 py-3 bg-gray-50 text-right sm:px-6",children:[e.jsx(C,{to:"/admin/categories",className:"inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 mr-3",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:j,className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:opacity-50 disabled:cursor-not-allowed",children:j?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white"}),s?"Creating...":"Saving..."]}):e.jsx(e.Fragment,{children:s?"Create Category":"Save Changes"})})]})]})})]})})};export{O as default};
