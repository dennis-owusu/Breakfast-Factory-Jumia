import{r as c,j as e,c as A,l as b,a6 as D,g as H,aj as I,L as q,E as G,h as J,C as K}from"./index-CW7sJ-MG.js";import{C as E}from"./circle-x-B3lywMU5.js";const V=async a=>{var g,i,p;try{const n=localStorage.getItem("token"),y={"Content-Type":"application/json",...n&&{Authorization:`Bearer ${n}`}},s=new URLSearchParams;a.search&&s.append("search",a.search),a.status&&a.status!=="all"&&s.append("status",a.status),a.category&&a.category!=="all"&&s.append("category",a.category),a.page&&s.append("page",a.page),a.limit&&s.append("limit",a.limit);const d=s.toString(),u=`/api/auth/get-all-users${d?`?${d}`:""}`,x=await fetch(u,{headers:y});if(!x.ok)throw new Error(`HTTP error ${x.status}: ${x.statusText}`);const h=await x.json(),o=(h.allUsers||[]).filter(r=>r.usersRole==="outlet").map(r=>({...r,name:r.storeName||r.name||"Unnamed Outlet",owner:{name:r.name||"Unknown",email:r.email||"No email"},description:r.description||"",categories:r.categories||[],status:r.status||"pending",productsCount:r.productsCount||0,ordersCount:r.ordersCount||0,totalSales:r.totalSales||0,rating:r.rating||0}));return{outlets:o,pagination:{total:((g=h.pagination)==null?void 0:g.total)||o.length,totalPages:((i=h.pagination)==null?void 0:i.totalPages)||1,currentPage:((p=h.pagination)==null?void 0:p.page)||1,limit:10}}}catch(n){throw console.error("Error fetching outlets:",n),n}},X=async(a,g)=>{try{const i=localStorage.getItem("token"),p={"Content-Type":"application/json",...i&&{Authorization:`Bearer ${i}`}},n=await fetch(`/api/auth/user/update/${a}`,{method:"PUT",headers:p,body:JSON.stringify({status:g})});if(!n.ok)throw new Error(`HTTP error ${n.status}: ${n.statusText}`);return await n.json()}catch(i){throw console.error("Error updating outlet status:",i),i}},Y=()=>{const[a,g]=c.useState(""),[i,p]=c.useState("all"),[n,y]=c.useState("all"),[s,d]=c.useState(1),[u]=c.useState(10),[x,h]=c.useState([]),[o,r]=c.useState({total:0,totalPages:0,currentPage:1,limit:10}),[S,C]=c.useState(!0),[k,j]=c.useState(null),[m,P]=c.useState(!1),[$,O]=c.useState(""),T=["Electronics","Fashion","Home & Kitchen","Beauty","Books","Sports"];c.useEffect(()=>{(async()=>{try{C(!0);const l=await V({search:a,status:i,category:n,page:s,limit:u});h(l.outlets),r(l.pagination),j(null)}catch{j("Failed to load outlets. Please try again later.")}finally{C(!1)}})()},[a,i,n,s,u]);const F=t=>{g(t.target.value),d(1)},L=t=>{p(t.target.value),d(1)},R=t=>{y(t.target.value),d(1)},_=()=>{s>1&&d(s-1)},z=()=>{s<o.totalPages&&d(s+1)},f=async(t,l)=>{const N=l==="active"?"approve":l==="rejected"?"reject":"update status of";if(window.confirm(`Are you sure you want to ${N} this outlet?`))try{P(!0);const w=await X(t,l);w.success?(h(U=>U.map(v=>v._id===t?{...v,status:l}:v)),O(w.message),setTimeout(()=>{O("")},3e3)):j("Failed to update outlet status. Please try again.")}catch{j("An error occurred. Please try again later.")}finally{P(!1)}},B=t=>{switch(t){case"active":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},M=t=>new Intl.NumberFormat("en-NG",{style:"currency",currency:"NGN",minimumFractionDigits:0,maximumFractionDigits:0}).format(t);return S&&x.length===0?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx(A,{size:"lg"})}):e.jsx("div",{className:"bg-gray-50 min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold leading-7 text-gray-900 sm:text-3xl sm:truncate",children:"Outlets Management"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Manage all seller outlets on the platform"})]}),$&&e.jsx("div",{className:"bg-green-50 border-l-4 border-green-500 p-4 mb-6",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(b,{className:"h-5 w-5 text-green-500"})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-green-700",children:$})})]})}),k&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 mb-6",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(D,{className:"h-5 w-5 text-red-500"})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-700",children:k})})]})}),e.jsx("div",{className:"bg-white shadow rounded-lg mb-6",children:e.jsx("div",{className:"px-4 py-5 sm:p-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"search",className:"block text-sm font-medium text-gray-700 sr-only",children:"Search"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(H,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",name:"search",id:"search",className:"focus:ring-orange-500 focus:border-orange-500 block w-full pl-10 sm:text-sm border-gray-300 rounded-md",placeholder:"Search by outlet name, description, or owner",value:a,onChange:F})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Status"}),e.jsxs("select",{id:"status",name:"status",className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md",value:i,onChange:L,children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700",children:"Category"}),e.jsxs("select",{id:"category",name:"category",className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md",value:n,onChange:R,children:[e.jsx("option",{value:"all",children:"All Categories"}),T.map((t,l)=>e.jsx("option",{value:t,children:t},l))]})]})]})})}),e.jsxs("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:[S&&x.length>0&&e.jsx("div",{className:"px-4 py-2 bg-gray-50 border-b border-gray-200",children:e.jsxs("div",{className:"flex justify-center",children:[e.jsx(A,{size:"sm"}),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:"Refreshing data..."})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Outlet"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Owner"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Products"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Orders"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sales"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rating"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No outlets found matching your criteria"})}):x.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-orange-100 flex items-center justify-center",children:e.jsx(I,{className:"h-5 w-5 text-orange-600"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.name}),e.jsx("div",{className:"text-xs text-gray-500 max-w-xs truncate",children:t.description}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:t.categories.map((l,N)=>e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800 mr-1",children:l},N))})]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:t.owner.name}),e.jsx("div",{className:"text-sm text-gray-500",children:t.owner.email})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${B(t.status)}`,children:t.status.charAt(0).toUpperCase()+t.status.slice(1)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.productsCount}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.ordersCount}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:M(t.totalSales)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})}),e.jsx("span",{className:"ml-1 text-sm text-gray-600",children:t.rating})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(q,{to:`/admin/outlets/${t._id}`,className:"text-orange-600 hover:text-orange-900",title:"View Details",children:e.jsx(G,{className:"h-5 w-5"})}),t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>f(t._id,"active"),disabled:m,className:`text-green-600 hover:text-green-900 ${m?"opacity-50 cursor-not-allowed":""}`,title:"Approve Outlet",children:e.jsx(b,{className:"h-5 w-5"})}),e.jsx("button",{type:"button",onClick:()=>f(t._id,"rejected"),disabled:m,className:`text-red-600 hover:text-red-900 ${m?"opacity-50 cursor-not-allowed":""}`,title:"Reject Outlet",children:e.jsx(E,{className:"h-5 w-5"})})]}),t.status==="active"&&e.jsx("button",{type:"button",onClick:()=>f(t._id,"inactive"),disabled:m,className:`text-red-600 hover:text-red-900 ${m?"opacity-50 cursor-not-allowed":""}`,title:"Deactivate Outlet",children:e.jsx(E,{className:"h-5 w-5"})}),t.status==="rejected"&&e.jsx("button",{type:"button",onClick:()=>f(t._id,"active"),disabled:m,className:`text-green-600 hover:text-green-900 ${m?"opacity-50 cursor-not-allowed":""}`,title:"Approve Outlet",children:e.jsx(b,{className:"h-5 w-5"})})]})})]},t._id))})]})}),o.totalPages>1&&e.jsx("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6",children:e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing ",e.jsx("span",{className:"font-medium",children:(s-1)*u+1})," to ",e.jsx("span",{className:"font-medium",children:Math.min(s*u,o.total)})," of"," ",e.jsx("span",{className:"font-medium",children:o.total})," results"]})}),e.jsx("div",{children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[e.jsxs("button",{onClick:_,disabled:s===1,className:`relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium ${s===1?"text-gray-300 cursor-not-allowed":"text-gray-500 hover:bg-gray-50"}`,children:[e.jsx("span",{className:"sr-only",children:"Previous"}),e.jsx(J,{className:"h-5 w-5","aria-hidden":"true"})]}),Array.from({length:o.totalPages},(t,l)=>l+1).map(t=>e.jsx("button",{onClick:()=>d(t),className:`relative inline-flex items-center px-4 py-2 border ${t===s?"z-10 bg-orange-50 border-orange-500 text-orange-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"} text-sm font-medium`,children:t},t)),e.jsxs("button",{onClick:z,disabled:s===o.totalPages,className:`relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium ${s===o.totalPages?"text-gray-300 cursor-not-allowed":"text-gray-500 hover:bg-gray-50"}`,children:[e.jsx("span",{className:"sr-only",children:"Next"}),e.jsx(K,{className:"h-5 w-5","aria-hidden":"true"})]})]})})]})})]})]})})};export{Y as default};
