import{r as x,j as e,L as z,n as D,l as B,a6 as U,g as H,c as v,T as q,h as R,C as J}from"./index-CW7sJ-MG.js";import{S as O}from"./square-pen-C0ENrl1l.js";const _=async n=>{try{const s=localStorage.getItem("token"),a={"Content-Type":"application/json",...s&&{Authorization:`Bearer ${s}`}},l=new URLSearchParams;n.search&&l.append("search",n.search),n.page&&l.append("page",n.page),n.limit&&l.append("limit",n.limit);const o=l.toString(),c=`/api/route/allcategories${o?`?${o}`:""}`,h=await fetch(c,{headers:a});if(!h.ok)throw new Error(`HTTP error ${h.status}: ${h.statusText}`);const f=await h.json(),r=(f.allCategory||[]).map(m=>{var u;return{...m,id:m._id||"",categoryName:m.categoryName||"Unknown",slug:m.slug||"",parentName:((u=m.parent)==null?void 0:u.categoryName)||null,productCount:m.productCount??0,status:m.status||"inactive",featured:m.featured??!1}});return{categories:r,total:f.total||r.length,currentPage:f.currentPage||1,totalPages:f.totalPages||1}}catch(s){throw console.error("Error fetching categories:",s),s}},G=async n=>{try{const s=localStorage.getItem("token"),a={"Content-Type":"application/json",...s&&{Authorization:`Bearer ${s}`}},l=await fetch(`/api/route/category/delete/${n}`,{method:"DELETE",headers:a});if(!l.ok)throw new Error(`HTTP error ${l.status}: ${l.statusText}`);return await l.json()}catch(s){throw console.error("Error deleting category:",s),s}},K=async(n,s)=>{try{const a=localStorage.getItem("token"),l={"Content-Type":"application/json",...a&&{Authorization:`Bearer ${a}`}},o=await fetch(`/api/route/update-categories/${n}`,{method:"PUT",headers:l,body:JSON.stringify({status:s})});if(!o.ok)throw new Error(`HTTP error ${o.status}: ${o.statusText}`);return await o.json()}catch(a){throw console.error("Error updating category status:",a),a}},Q=async(n,s)=>{try{const a=localStorage.getItem("token"),l={"Content-Type":"application/json",...a&&{Authorization:`Bearer ${a}`}},o=await fetch(`/api/route/update-categories/${n}`,{method:"PUT",headers:l,body:JSON.stringify({featured:s})});if(!o.ok)throw new Error(`HTTP error ${o.status}: ${o.statusText}`);return await o.json()}catch(a){throw console.error("Error updating category featured:",a),a}},X=()=>{const[n,s]=x.useState([]),[a,l]=x.useState(!0),[o,c]=x.useState(null),[h,f]=x.useState(""),[r,m]=x.useState(1),[u,k]=x.useState(1),[C,T]=x.useState(0),[P,$]=x.useState(!1),[E,A]=x.useState(null),[j,y]=x.useState(""),[g,w]=x.useState({id:null,type:null});x.useEffect(()=>{(async()=>{try{l(!0),c(null);const i=await _({search:h,page:r,limit:10});s(i.categories),k(i.totalPages),T(i.totalCategories),m(i.currentPage)}catch{c("Failed to load categories. Please try again.")}finally{l(!1)}})()},[h,r]);const L=t=>{t.preventDefault(),m(1)},N=t=>{t<1||t>u||m(t)},F=async t=>{if(window.confirm("Are you sure you want to delete this category? This action cannot be undone."))try{$(!0),A(t),c(null);const i=await G(t);i.success?(y(i.message),s(d=>d.filter(p=>p.id!==t)),T(d=>d-1),k(Math.ceil((C-1)/10)),n.length===1&&r>1&&m(d=>d-1)):c(i.message||"Failed to delete category")}catch{c("An error occurred while deleting the category")}finally{$(!1),A(null),j&&setTimeout(()=>{y("")},3e3)}},I=async(t,i)=>{try{w({id:t,type:"status"}),c(null);const d=i==="active"?"inactive":"active",p=await K(t,d);p.success?(y(p.message),s(b=>b.map(S=>S.id===t?{...S,status:d}:S))):c(p.message||"Failed to update category status")}catch{c("An error occurred while updating the category status")}finally{w({id:null,type:null}),j&&setTimeout(()=>{y("")},3e3)}},M=async(t,i)=>{try{w({id:t,type:"featured"}),c(null);const d=await Q(t,!i);d.success?(y(d.message),s(p=>p.map(b=>b.id===t?{...b,featured:!i}:b))):c(d.message||"Failed to update category featured status")}catch{c("An error occurred while updating the category featured status")}finally{w({id:null,type:null}),j&&setTimeout(()=>{y("")},3e3)}};return e.jsx("div",{className:"bg-gray-50 min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold leading-7 text-gray-900 sm:text-3xl sm:truncate",children:"Categories Management"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Manage product categories for your e-commerce store"})]}),e.jsx("div",{className:"mt-4 sm:mt-0",children:e.jsxs(z,{to:"/admin/categories/new",className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500",children:[e.jsx(D,{className:"-ml-1 mr-2 h-5 w-5"}),"Add New Category"]})})]}),j&&e.jsx("div",{className:"mb-4 bg-green-50 border-l-4 border-green-400 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(B,{className:"h-5 w-5 text-green-400"})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-green-700",children:j})})]})}),o&&e.jsx("div",{className:"mb-4 bg-red-50 border-l-4 border-red-400 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(U,{className:"h-5 w-5 text-red-400"})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-700",children:o})})]})}),e.jsx("div",{className:"bg-white shadow rounded-lg mb-6",children:e.jsx("div",{className:"px-4 py-5 sm:p-6",children:e.jsxs("form",{onSubmit:L,className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"search",className:"sr-only",children:"Search"}),e.jsxs("div",{className:"relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(H,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",name:"search",id:"search",className:"focus:ring-orange-500 focus:border-orange-500 block w-full pl-10 sm:text-sm border-gray-300 rounded-md",placeholder:"Search by name or description",value:h,onChange:t=>f(t.target.value)})]})]}),e.jsx("button",{type:"submit",className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500",children:"Search"})]})})}),e.jsxs("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:[a&&!n.length?e.jsxs("div",{className:"px-4 py-12 text-center",children:[e.jsx(v,{size:"lg"}),e.jsx("p",{className:"mt-4 text-gray-500",children:"Loading categories..."})]}):!a&&!n.length?e.jsx("div",{className:"px-4 py-12 text-center",children:e.jsx("p",{className:"text-gray-500",children:"No categories found. Try a different search or add a new category."})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Parent"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Products"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Featured"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.categoryName||"Unknown"}),e.jsx("div",{className:"text-sm text-gray-500",children:t.slug||"No slug"})]})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:t.parentName||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:t.productCount??0})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("button",{onClick:()=>I(t.id,t.status),disabled:g.id===t.id&&g.type==="status",className:"relative inline-flex items-center",children:[e.jsx("span",{className:`${t.status==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"} px-2 inline-flex text-xs leading-5 font-semibold rounded-full`,children:t.status==="active"?"Active":"Inactive"}),g.id===t.id&&g.type==="status"&&e.jsx("span",{className:"ml-2",children:e.jsx(v,{size:"xs"})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("button",{onClick:()=>M(t.id,t.featured),disabled:g.id===t.id&&g.type==="featured",className:"relative inline-flex items-center",children:[e.jsx("span",{className:`${t.featured?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"} px-2 inline-flex text-xs leading-5 font-semibold rounded-full`,children:t.featured?"Featured":"Not Featured"}),g.id===t.id&&g.type==="featured"&&e.jsx("span",{className:"ml-2",children:e.jsx(v,{size:"xs"})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(z,{to:`/admin/categories/${t.id}`,className:"text-indigo-600 hover:text-indigo-900",children:e.jsx(O,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>F(t.id),disabled:P&&E===t.id,className:"text-red-600 hover:text-red-900",children:P&&E===t.id?e.jsx(v,{size:"xs"}):e.jsx(q,{className:"h-5 w-5"})})]})})]},t.id))})]})}),u>1&&e.jsxs("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6",children:[e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing ",e.jsx("span",{className:"font-medium",children:(r-1)*10+1})," to ",e.jsx("span",{className:"font-medium",children:Math.min(r*10,C)})," of"," ",e.jsx("span",{className:"font-medium",children:C})," categories"]})}),e.jsx("div",{children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[e.jsxs("button",{onClick:()=>N(r-1),disabled:r===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"sr-only",children:"Previous"}),e.jsx(R,{className:"h-5 w-5"})]}),Array.from({length:u},(t,i)=>i+1).map(t=>e.jsx("button",{onClick:()=>N(t),className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${r===t?"z-10 bg-orange-50 border-orange-500 text-orange-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,children:t},t)),e.jsxs("button",{onClick:()=>N(r+1),disabled:r===u,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"sr-only",children:"Next"}),e.jsx(J,{className:"h-5 w-5"})]})]})})]}),e.jsxs("div",{className:"flex sm:hidden justify-between items-center",children:[e.jsx("button",{onClick:()=>N(r-1),disabled:r===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsxs("p",{className:"text-sm text-gray-700",children:["Page ",e.jsx("span",{className:"font-medium",children:r})," of ",e.jsx("span",{className:"font-medium",children:u})]}),e.jsx("button",{onClick:()=>N(r+1),disabled:r===u,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]})]})})};export{X as default};
