import{u as V,a as B,z as U,A as W,r as c,F as z,G,j as e,J as P,I as p,B as r,g as J,p as q,q as Q,s as F,t as A,v as n,X as K,K as X}from"./index-CW7sJ-MG.js";import{F as Y}from"./funnel-DV1gsmvk.js";const H=()=>{const i=V(),{requests:j,loading:x,error:g,success:h,totalRequests:m}=B(s=>s.restock),[N]=U(),T=W(),[t,d]=c.useState({page:1,limit:10,totalRequests:0,totalPages:1}),[o,y]=c.useState(""),[a,f]=c.useState({status:"all",dateRange:"all"}),[v,D]=c.useState(!1),[u,b]=c.useState({productId:N.get("productId")||"",requestedQuantity:"",currentQuantity:N.get("quantity")||""}),I=s=>{y(s.target.value),d({...t,page:1})},S=(s,l)=>{f({...a,[s]:l}),d({...t,page:1})},E=()=>{y(""),f({status:"all",dateRange:"all"}),d({...t,page:1})},R=s=>{const l=t.page+s;l>0&&l<=t.totalPages&&d({...t,page:l})};c.useEffect(()=>{const s=new URLSearchParams;s.append("startIndex",(t.page-1)*t.limit),s.append("limit",t.limit),o&&s.append("searchTerm",o),a.status!=="all"&&s.append("status",a.status),a.dateRange!=="all"&&s.append("dateRange",a.dateRange),i(z(s.toString()))},[i,t.page,t.limit,o,a]),c.useEffect(()=>{d(s=>({...s,totalRequests:m||0,totalPages:Math.ceil((m||0)/s.limit)||1}))},[m]),c.useEffect(()=>{h&&(b({productId:"",requestedQuantity:"",reason:""}),setTimeout(()=>i(G()),3e3))},[h,i]);const M=s=>{s.preventDefault(),i(X(u))},O=s=>{b({...u,[s.target.name]:s.target.value})},L=s=>{switch(s){case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-yellow-100 text-yellow-800"}};return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Restock Management"}),e.jsx(P,{className:"mb-8",children:e.jsxs("form",{onSubmit:M,className:"p-6 space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Create Restock Request"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block font-medium",children:"Current Stock"}),e.jsx(p,{value:u.currentQuantity,disabled:!0,className:"bg-gray-50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"requestedQuantity",className:"block font-medium",children:"Add Quantity"}),e.jsx(p,{id:"requestedQuantity",name:"requestedQuantity",type:"number",min:"1",value:u.requestedQuantity,onChange:O,required:!0,placeholder:"Enter quantity to add"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{type:"submit",disabled:x,className:"flex-1",children:x?"Submitting...":"Submit Request"}),e.jsx(r,{type:"button",variant:"outline",onClick:()=>T("/outlet/products"),children:"Cancel"})]}),g&&e.jsx("p",{className:"text-red-500 mt-2",children:g}),h&&e.jsx("p",{className:"text-green-500 mt-2",children:"Restock request created successfully!"})]})}),e.jsx(P,{className:"mt-8",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Your Restock Requests"}),e.jsx(r,{variant:"ghost",onClick:()=>D(!v),children:e.jsx(Y,{className:"h-4 w-4"})})]}),v&&e.jsxs("div",{className:"mb-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(J,{className:"h-4 w-4 text-gray-500"}),e.jsx(p,{placeholder:"Search requests...",value:o,onChange:I,className:"flex-1"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(q,{value:a.status,onValueChange:s=>S("status",s),children:[e.jsx(Q,{children:e.jsx(F,{placeholder:"Status"})}),e.jsxs(A,{children:[e.jsx(n,{value:"all",children:"All Status"}),e.jsx(n,{value:"pending",children:"Pending"}),e.jsx(n,{value:"approved",children:"Approved"}),e.jsx(n,{value:"rejected",children:"Rejected"})]})]}),e.jsxs(q,{value:a.dateRange,onValueChange:s=>S("dateRange",s),children:[e.jsx(Q,{children:e.jsx(F,{placeholder:"Date Range"})}),e.jsxs(A,{children:[e.jsx(n,{value:"all",children:"All Time"}),e.jsx(n,{value:"today",children:"Today"}),e.jsx(n,{value:"thisWeek",children:"This Week"}),e.jsx(n,{value:"thisMonth",children:"This Month"})]})]})]}),e.jsxs(r,{variant:"outline",onClick:E,className:"w-full",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Clear Filters"]})]}),x?e.jsx("p",{children:"Loading requests..."}):j.length===0?e.jsx("p",{children:"No restock requests found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 px-4",children:"Product"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Outlet"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Requested Qty"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Current Qty"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Status"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Date"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Admin Note"})]})}),e.jsx("tbody",{children:j.map(s=>{var l,k,C,w;return e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:((l=s.product)==null?void 0:l.productName)||"N/A"}),e.jsx("td",{className:"py-3 px-4",children:((k=s.outlet)==null?void 0:k.storeName)||((C=s.outlet)==null?void 0:C.name)||((w=s.outlet)==null?void 0:w.email)||"Unknown Outlet"}),e.jsx("td",{className:"py-3 px-4",children:s.requestedQuantity}),e.jsx("td",{className:"py-3 px-4",children:s.currentQuantity}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`px-2 py-1 rounded text-sm ${L(s.status)}`,children:s.status})}),e.jsx("td",{className:"py-3 px-4",children:new Date(s.createdAt).toLocaleDateString()}),e.jsx("td",{className:"py-3 px-4",children:s.adminNote||"-"})]},s._id)})})]})}),t.totalPages>1&&e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsx(r,{onClick:()=>R(-1),disabled:t.page===1,children:"Previous"}),e.jsxs("span",{children:["Page ",t.page," of ",t.totalPages]}),e.jsx(r,{onClick:()=>R(1),disabled:t.page===t.totalPages,children:"Next"})]})]})})]})};export{H as default};
