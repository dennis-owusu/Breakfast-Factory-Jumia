import{a0 as J,a as W,A as X,r as o,j as e,c as G,B as b,h as K,I as v,p as Q,q as Y,s as Z,t as ee,v as se,w as te,X as D,n as ae,e as p}from"./index-CW7sJ-MG.js";import{T as re}from"./textarea-B1GM8hMp.js";import{L as ce}from"./loader-BXkacTqF.js";const ue=()=>{const{id:g}=J(),{currentUser:w}=W(t=>t.user),k=X(),[S,C]=o.useState(!1),[R,F]=o.useState(!0),[I,x]=o.useState(null),[B,O]=o.useState([]),[ie,L]=o.useState(!1),[r,m]=o.useState({title:"",description:"",price:"",discountPrice:"",stock:"",category:"",specifications:[],featured:!1}),[l,f]=o.useState({}),[h,$]=o.useState({key:"",value:""}),[j,E]=o.useState([]),[y,P]=o.useState([]),[le,oe]=o.useState(!1),[U,A]=o.useState("");o.useEffect(()=>{(async()=>{try{L(!0);const a=await fetch("/api/route/allcategories",{headers:{Authorization:`Bearer ${w==null?void 0:w.token}`}});if(!a.ok)throw new Error(`HTTP error ${a.status}: ${a.statusText}`);const c=await a.json(),d=Array.isArray(c.allCategory)?c.allCategory.map(i=>({_id:i._id,name:i.categoryName})):[];O(d)}catch(a){console.error("Fetch categories error:",a.message),x("Failed to load categories"),p.error("Failed to load categories")}finally{L(!1)}})(),(async()=>{var a,c,d,i;try{F(!0);const u=await fetch(`/api/route/product/${g}`);if(!u.ok)throw new Error(`HTTP error ${u.status}: ${u.statusText}`);const n=await u.json();m({title:n.productName||"",description:n.description||"",price:((a=n.productPrice)==null?void 0:a.toString())||"",discountPrice:((c=n.discountPrice)==null?void 0:c.toString())||"",stock:((d=n.numberOfProductsAvailable)==null?void 0:d.toString())||"",category:((i=n.category)==null?void 0:i._id)||n.category||"",specifications:n.specifications||[],featured:n.featured||!1}),n.productImage&&(A(n.productImage),P([n.productImage])),x(null)}catch(u){console.error("Error fetching product:",u),x("Failed to load product. Please try again."),p.error("Failed to load product")}finally{F(!1)}})()},[g]);const N=t=>{const{name:s,value:a,type:c,checked:d}=t.target;c==="checkbox"?m(i=>({...i,[s]:d})):s==="price"||s==="discountPrice"||s==="stock"?(a===""||/^\d*\.?\d*$/.test(a))&&m(i=>({...i,[s]:a})):m(i=>({...i,[s]:a})),l[s]&&f(i=>({...i,[s]:null}))},_=t=>{const s=Array.from(t.target.files);if(s.length===0)return;if(j.length+s.length>5){x("Maximum 5 images allowed."),p.error("Maximum 5 images allowed.");return}const a=[...j,...s];E(a);const c=[];s.forEach(d=>{const i=new FileReader;i.onloadend=()=>{c.push(i.result),c.length===s.length&&P(u=>[...u,...c])},i.readAsDataURL(d)}),l.images&&f(d=>({...d,images:null}))},q=t=>{t===0&&y[0]===U&&A("");const s=[...j],a=[...y];a[t]&&a[t].startsWith("blob:")&&URL.revokeObjectURL(a[t]),s.splice(t,1),a.splice(t,1),E(s),P(a),a.length===0&&f(c=>({...c,images:"At least one image required"}))},T=t=>{const{name:s,value:a}=t.target;$(c=>({...c,[s]:a}))},z=()=>{!h.key.trim()||!h.value.trim()||(m(t=>({...t,specifications:[...t.specifications,{...h}]})),$({key:"",value:""}))},M=t=>{m(s=>({...s,specifications:s.specifications.filter((a,c)=>c!==t)}))},V=()=>{const t={};return r.price&&isNaN(parseFloat(r.price))&&(t.price="Price must be a number"),r.discountPrice&&isNaN(parseFloat(r.discountPrice))&&(t.discountPrice="Discount price must be a number"),r.stock&&isNaN(parseInt(r.stock))&&(t.stock="Stock must be a number"),f(t),Object.keys(t).length===0},H=async t=>{if(t.preventDefault(),!V()){const s=document.querySelector(".error-message");s&&s.scrollIntoView({behavior:"smooth",block:"center"}),p.error("Please fill all required fields");return}C(!0),x(null);try{const s=new FormData;s.append("productName",r.title),s.append("category",r.category),s.append("numberOfProductsAvailable",parseInt(r.stock,10)),s.append("productPrice",parseFloat(r.price)),r.discountPrice&&s.append("discountPrice",parseFloat(r.discountPrice)),s.append("description",r.description),s.append("specifications",JSON.stringify(r.specifications)),s.append("featured",r.featured),j.length>0&&s.append("productImage",j[0]);const a=await fetch(`/api/route/update/${g}`,{method:"PUT",body:s}),c=await a.json();if(!a.ok)throw new Error(c.message||"Failed to update product");p.success("Product updated successfully!"),k(`/outlet/product/${g}`)}catch(s){x(s.message),p.error(s.message)}finally{C(!1)}};return R?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(G,{size:"lg"})}):e.jsx("div",{className:"bg-gray-50 min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"md:flex md:items-center md:justify-between mb-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs(b,{onClick:()=>k(`/outlet/product/${g}`),variant:"ghost",className:"mr-4 text-gray-600 hover:text-gray-900",children:[e.jsx(K,{className:"h-5 w-5 mr-1"}),"Back"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 sm:text-3xl",children:"Edit Product"})]})}),I&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 p-4 mb-6",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-700",children:I})})]})}),e.jsxs("form",{onSubmit:H,className:"space-y-8",children:[e.jsx("div",{className:"bg-white shadow-sm rounded-lg overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6",children:[e.jsxs("div",{className:"sm:col-span-4",children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"Product Title"}),e.jsxs("div",{className:"mt-1",children:[e.jsx(v,{type:"text",name:"title",id:"title",value:r.title,onChange:N,className:l.title?"border-red-300":""}),l.title&&e.jsx("p",{className:"mt-2 text-sm text-red-600 error-message",children:l.title})]})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700",children:"Category"}),e.jsxs("div",{className:"mt-1",children:[e.jsxs(Q,{name:"category",value:r.category,onValueChange:t=>{m(s=>({...s,category:t})),l.category&&f(s=>({...s,category:null}))},children:[e.jsx(Y,{className:l.category?"border-red-300":"",children:e.jsx(Z,{placeholder:"Select category"})}),e.jsx(ee,{children:B.map(t=>e.jsx(se,{value:t._id,children:t.name},t._id))})]}),l.category&&e.jsx("p",{className:"mt-2 text-sm text-red-600 error-message",children:l.category})]})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("div",{className:"mt-1",children:e.jsx(re,{id:"description",name:"description",rows:4,value:r.description,onChange:N,placeholder:"Describe your product..."})})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{htmlFor:"price",className:"block text-sm font-medium text-gray-700",children:"Price ($)"}),e.jsxs("div",{className:"mt-1",children:[e.jsx(v,{type:"text",name:"price",id:"price",value:r.price,onChange:N,className:l.price?"border-red-300":""}),l.price&&e.jsx("p",{className:"mt-2 text-sm text-red-600 error-message",children:l.price})]})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{htmlFor:"discountPrice",className:"block text-sm font-medium text-gray-700",children:"Discount Price ($)"}),e.jsx("div",{className:"mt-1",children:e.jsx(v,{type:"text",name:"discountPrice",id:"discountPrice",value:r.discountPrice,onChange:N,placeholder:"Optional"})})]}),e.jsx("div",{className:"sm:col-span-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(te,{id:"featured",name:"featured",checked:r.featured,onCheckedChange:t=>{m(s=>({...s,featured:t}))}}),e.jsx("label",{htmlFor:"featured",className:"ml-2 block text-sm text-gray-900",children:"Feature this product on the homepage"})]})})]})]})}),e.jsx("div",{className:"bg-white shadow-sm rounded-lg overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Product Images"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4",children:[y.map((t,s)=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-24 w-24 rounded-md overflow-hidden bg-gray-100",children:e.jsx("img",{src:t,alt:`Preview ${s+1}`,className:"h-full w-full object-cover"})}),e.jsx("button",{type:"button",onClick:()=>q(s),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 shadow-sm hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:e.jsx(D,{className:"h-3 w-3"})})]},s)),y.length<5&&e.jsx("div",{className:"h-24 w-24 rounded-md border-2 border-dashed border-gray-300 flex items-center justify-center",children:e.jsxs("label",{htmlFor:"image-upload",className:"cursor-pointer flex flex-col items-center justify-center w-full h-full",children:[e.jsx(ae,{className:"h-6 w-6 text-gray-400"}),e.jsx("span",{className:"mt-1 text-xs text-gray-500",children:"Add Image"}),e.jsx("input",{id:"image-upload",name:"image-upload",type:"file",accept:"image/*",onChange:_,className:"sr-only"})]})})]}),l.images&&e.jsx("p",{className:"text-sm text-red-600 error-message",children:l.images}),e.jsx("p",{className:"text-sm text-gray-500",children:"Upload up to 5 images. First image will be used as the product thumbnail."})]})]})}),e.jsx("div",{className:"bg-white shadow-sm rounded-lg overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Specifications"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{htmlFor:"spec-key",className:"block text-sm font-medium text-gray-700",children:"Specification"}),e.jsx("div",{className:"mt-1",children:e.jsx(v,{type:"text",name:"key",id:"spec-key",value:h.key,onChange:T,placeholder:"e.g. Color"})})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"spec-value",className:"block text-sm font-medium text-gray-700",children:"Value"}),e.jsx("div",{className:"mt-1",children:e.jsx(v,{type:"text",name:"value",id:"spec-value",value:h.value,onChange:T,placeholder:"e.g. Red"})})]}),e.jsx("div",{className:"sm:col-span-1 flex items-end",children:e.jsx(b,{type:"button",onClick:z,disabled:!h.key.trim()||!h.value.trim(),className:"w-full",children:"Add"})})]}),r.specifications.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Added Specifications"}),e.jsx("div",{className:"bg-gray-50 rounded-md p-3",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:r.specifications.map((t,s)=>e.jsxs("li",{className:"py-2 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium text-gray-900",children:[t.key,": "]}),e.jsx("span",{className:"text-gray-700",children:t.value})]}),e.jsx("button",{type:"button",onClick:()=>M(s),className:"text-red-500 hover:text-red-700",children:e.jsx(D,{className:"h-4 w-4"})})]},s))})})]})]})]})}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(b,{type:"button",onClick:()=>k(`/outlet/product/${g}`),variant:"outline",className:"border-gray-300 text-gray-700",children:"Cancel"}),e.jsx(b,{type:"submit",disabled:S,className:"bg-orange-500 hover:bg-orange-600 text-white",children:S?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"animate-spin h-4 w-4 mr-2"}),"Saving..."]}):"Save Changes"})]})]})]})})};export{ue as default};
