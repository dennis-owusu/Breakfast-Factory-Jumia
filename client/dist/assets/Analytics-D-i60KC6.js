import{a as P,r as c,j as e,c as T,a6 as C,D as B,d as o,S as A,e as O}from"./index-CW7sJ-MG.js";import{C as E}from"./calendar-C6BTQIk3.js";import{T as $}from"./trending-up-DTQPjW96.js";import{R as g,L as I,C as f,X as w,Y as j,T as p,a as u,b,P as K,c as M,d as R,B as z,e as V}from"./PieChart-DrPfqSBa.js";const G=()=>{const{currentUser:l}=P(s=>s.user),x=l||{},[d,k]=c.useState("monthly"),[t,D]=c.useState(null),[F,m]=c.useState(!0),[y,h]=c.useState(null),N=["#FF6B3D","#FFA53D","#FFD03D","#3D9BFF","#3DFFB5","#FF3D77"];c.useEffect(()=>{const s=async()=>{try{m(!0),h(null);const a={"Content-Type":"application/json",...(l==null?void 0:l.token)&&{Authorization:`Bearer ${l.token}`}},i=await fetch(`/api/route/analytics?period=${d}&outletId=${x._id}`,{headers:a});if(!i.ok)throw new Error(`HTTP error ${i.status}: ${i.statusText}`);const r=i.headers.get("content-type");if(!r||!r.includes("application/json"))throw new Error("Invalid response: Expected JSON");const n=await i.json();if(!n.success)throw new Error(n.message||"Failed to fetch analytics data");D(n.data)}catch(a){console.error("Failed to load analytics data:",a.message),h("Failed to load analytics data. Please try again later."),O.error("Failed to load analytics data")}finally{m(!1)}};x._id?s():(h("No outlet found. Please ensure you are logged in."),m(!1))},[d,x._id,l==null?void 0:l.token]);const S=s=>{k(s.target.value)},v=({active:s,payload:a,label:i})=>s&&a&&a.length?e.jsxs("div",{className:"bg-white p-3 border border-gray-200 shadow-md rounded-md",children:[e.jsx("p",{className:"font-medium text-gray-900",children:i}),a.map((r,n)=>e.jsxs("p",{style:{color:r.color},className:"text-sm",children:[r.name,": ",r.name==="sales"?o(r.value):r.value]},n))]}):null,L=({active:s,payload:a})=>s&&a&&a.length?e.jsxs("div",{className:"bg-white p-3 border border-gray-200 shadow-md rounded-md",children:[e.jsx("p",{className:"font-medium text-gray-900",children:a[0].name}),e.jsx("p",{style:{color:a[0].color},className:"text-sm",children:o(a[0].value)})]}):null;return F?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx(T,{size:"lg"})}):y||!t?e.jsx("div",{className:"bg-gray-50 min-h-screen py-8",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center text-red-500",children:[e.jsx(C,{className:"h-6 w-6 mr-2"}),e.jsx("p",{children:y||"No data available. Please try again later."})]})})})}):e.jsx("div",{className:"bg-gray-50 min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold leading-7 text-gray-900 sm:text-3xl sm:truncate",children:[x.name||"Outlet"," Analytics"]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"View sales, orders, and product statistics for your outlet"})]}),e.jsx("div",{className:"bg-white shadow rounded-lg mb-6",children:e.jsx("div",{className:"px-4 py-5 sm:p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(E,{className:"h-5 w-5 text-gray-400 mr-2"}),e.jsx("label",{htmlFor:"period",className:"block text-sm font-medium text-gray-700 mr-4",children:"Time Period"}),e.jsxs("select",{id:"period",name:"period",className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md",value:d,onChange:S,"aria-label":"Select time period",children:[e.jsx("option",{value:"daily",children:"Last 7 Days"}),e.jsx("option",{value:"weekly",children:"Last 4 Weeks"}),e.jsx("option",{value:"monthly",children:"Last 6 Months"}),e.jsx("option",{value:"yearly",children:"Last 12 Months"})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4 mb-6",children:[e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(B,{className:"h-6 w-6 text-orange-600"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Total Sales"}),e.jsx("dd",{children:e.jsx("div",{className:"text-lg font-medium text-gray-900",children:o(t.summaryData.totalSales)})})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(A,{className:"h-6 w-6 text-orange-600"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Total Orders"}),e.jsx("dd",{children:e.jsx("div",{className:"text-lg font-medium text-gray-900",children:t.summaryData.totalOrders.toLocaleString()})})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx($,{className:"h-6 w-6 text-orange-600"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Avg. Order Value"}),e.jsx("dd",{children:e.jsx("div",{className:"text-lg font-medium text-gray-900",children:o(t.summaryData.averageOrderValue)})})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-6 w-6 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Total Products"}),e.jsx("dd",{children:e.jsx("div",{className:"text-lg font-medium text-gray-900",children:t.summaryData.totalProducts.toLocaleString()})})]})})]})})})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg mb-6",children:[e.jsxs("div",{className:"px-4 py-5 sm:px-6",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Sales & Orders"}),e.jsx("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:d==="daily"?"Last 7 days":d==="weekly"?"Last 4 weeks":d==="monthly"?"Last 6 months":"Last 12 months"})]}),e.jsx("div",{className:"px-4 pb-5",children:e.jsx("div",{className:"h-80",children:e.jsx(g,{width:"100%",height:"100%",children:e.jsxs(I,{data:t.salesData,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(f,{strokeDasharray:"3 3"}),e.jsx(w,{dataKey:"date"}),e.jsx(j,{yAxisId:"left",orientation:"left",stroke:"#FF6B3D"}),e.jsx(j,{yAxisId:"right",orientation:"right",stroke:"#3D9BFF"}),e.jsx(p,{content:e.jsx(v,{})}),e.jsx(u,{}),e.jsx(b,{yAxisId:"left",type:"monotone",dataKey:"sales",name:"Sales (₵)",stroke:"#FF6B3D",activeDot:{r:8}}),e.jsx(b,{yAxisId:"right",type:"monotone",dataKey:"orders",name:"Orders",stroke:"#3D9BFF"})]})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2 mb-6",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"px-4 py-5 sm:px-6",children:e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Sales by Product"})}),e.jsx("div",{className:"px-4 pb-5",children:e.jsx("div",{className:"h-80",children:e.jsx(g,{width:"100%",height:"100%",children:e.jsxs(K,{children:[e.jsx(M,{data:t.productData,cx:"50%",cy:"50%",labelLine:!1,outerRadius:80,fill:"#8884d8",dataKey:"value",nameKey:"name",label:({name:s,percent:a})=>`${s} ${(a*100).toFixed(0)}%`,children:t.productData.map((s,a)=>e.jsx(R,{fill:N[a%N.length]},`cell-${a}`))}),e.jsx(p,{content:e.jsx(L,{})}),e.jsx(u,{})]})})})})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"px-4 py-5 sm:px-6",children:e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Monthly Sales Trend"})}),e.jsx("div",{className:"px-4 pb-5",children:e.jsx("div",{className:"h-80",children:e.jsx(g,{width:"100%",height:"100%",children:e.jsxs(z,{data:t.salesData,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(f,{strokeDasharray:"3 3"}),e.jsx(w,{dataKey:"date"}),e.jsx(j,{}),e.jsx(p,{content:e.jsx(v,{})}),e.jsx(u,{}),e.jsx(V,{dataKey:"sales",name:"Sales (₵)",fill:"#FF6B3D"})]})})})})]})]}),e.jsxs("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg mb-6",children:[e.jsx("div",{className:"px-4 py-5 sm:px-6",children:e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Top Selling Products"})}),e.jsx("div",{className:"border-t border-gray-200",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sales"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Units Sold"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.topProducts.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:s.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.name||s.category||"Uncategorized"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:o(s.sales)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.units.toLocaleString()})]},s.id))})]})})})]})]})})};export{G as default};
