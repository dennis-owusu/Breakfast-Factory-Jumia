import{i as W,r as o,a as Y,j as e,c as T,a6 as Z,g as ee,f as A,L as E,E as te,T as se,h as ae,C as re,e as h}from"./index-CW7sJ-MG.js";import{S as ne}from"./square-pen-C0ENrl1l.js";import{U as le}from"./user-check-CBVfdRAH.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],ie=W("user-x",oe),me=()=>{const R=async t=>{var s,a;try{const n=localStorage.getItem("token"),r={"Content-Type":"application/json",...n&&{Authorization:`Bearer ${n}`}},i=new URLSearchParams;t.search&&i.append("search",t.search),t.role&&t.role!=="all"&&i.append("role",t.role),t.status&&t.status!=="all"&&i.append("status",t.status),t.page&&i.append("page",t.page),t.limit&&i.append("limit",t.limit);const P=i.toString(),Q=`/api/auth/get-all-users${P?`?${P}`:""}`,y=await fetch(Q,{headers:r});if(!y.ok)throw new Error(`HTTP error ${y.status}: ${y.statusText}`);const b=await y.json();return{users:b.allUsers||[],pagination:{total:((s=b.allUsers)==null?void 0:s.length)||0,totalPages:Math.ceil((((a=b.allUsers)==null?void 0:a.length)||0)/t.limit),currentPage:t.page,limit:t.limit}}}catch(n){throw console.error("Error fetching users:",n),n}},L=async(t,s)=>{try{const a=localStorage.getItem("token"),n={"Content-Type":"application/json",...a&&{Authorization:`Bearer ${a}`}},r=await fetch(`/api/auth/user/update/${t}`,{method:"PUT",headers:n,body:JSON.stringify({status:s})});if(!r.ok)throw new Error(`HTTP error ${r.status}: ${r.statusText}`);return await r.json()}catch(a){throw console.error("Error updating user status:",a),a}},z=async(t,s)=>{try{const a=localStorage.getItem("token"),n={"Content-Type":"application/json",...a&&{Authorization:`Bearer ${a}`}},r=await fetch(`/api/auth/user/update/${t}`,{method:"PUT",headers:n,body:JSON.stringify({usersRole:s})});if(!r.ok)throw new Error(`HTTP error ${r.status}: ${r.statusText}`);return await r.json()}catch(a){throw console.error("Error updating user role:",a),a}},_=async t=>{try{const s=localStorage.getItem("token"),a={"Content-Type":"application/json",...s&&{Authorization:`Bearer ${s}`}},n=await fetch(`/api/auth/user/${t}`,{method:"DELETE",headers:a});if(!n.ok)throw new Error(`HTTP error ${n.status}: ${n.statusText}`);return await n.json()}catch(s){throw console.error("Error deleting user:",s),s}},[f,M]=o.useState(""),{currentUser:ce}=Y(t=>t.user),[j,F]=o.useState("all"),[v,O]=o.useState("all"),[l,d]=o.useState(1),[m]=o.useState(10),[g,p]=o.useState([]),[c,w]=o.useState({total:0,totalPages:0,currentPage:1,limit:10}),[N,k]=o.useState(!0),[U,S]=o.useState(null),[x,u]=o.useState(!1),[$,de]=o.useState("");o.useEffect(()=>{(async()=>{try{k(!0);const s=await R({search:f,role:j,status:v,page:l,limit:m});p(s.users),w(s.pagination),S(null)}catch{S("Failed to load users. Please try again later.")}finally{k(!1)}})()},[f,j,v,l,m]);const B=t=>{M(t.target.value),d(1)},D=t=>{F(t.target.value),d(1)},H=t=>{O(t.target.value),d(1)},q=()=>{l>1&&d(l-1)},I=()=>{l<c.totalPages&&d(l+1)},J=async(t,s)=>{if(window.confirm(`Are you sure you want to ${s==="active"?"activate":"deactivate"} this user?`))try{u(!0);const a=await L(t,s);p(n=>n.map(r=>r._id===t?{...r,status:s}:r)),h.success("User status updated successfully")}catch{h.error("Failed to update user status")}finally{u(!1)}},V=async(t,s)=>{if(window.confirm(`Are you sure you want to change this user's role to ${C(s)}?`))try{u(!0);const a=await z(t,s);p(n=>n.map(r=>r._id===t?{...r,usersRole:s}:r)),h.success("User role updated successfully")}catch{h.error("Failed to update user role")}finally{u(!1)}},X=async t=>{if(window.confirm("Are you sure you want to delete this user? This action cannot be undone."))try{u(!0),await _(t),p(s=>s.filter(a=>a._id!==t)),w(s=>({...s,total:s.total-1})),h.success("User deleted successfully")}catch{h.error("Failed to delete user")}finally{u(!1)}},G=t=>{switch(t){case"admin":return"bg-purple-100 text-purple-800";case"outlet":return"bg-blue-100 text-blue-800";case"user":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},K=t=>{switch(t){case"active":return"bg-green-100 text-green-800";case"inactive":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},C=t=>{if(!t)return"Unknown";switch(t){case"admin":return"Admin";case"outlet":return"Outlet Owner";case"user":return"Customer";default:return t.charAt(0).toUpperCase()+t.slice(1)}};return N&&g.length===0?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx(T,{size:"lg"})}):e.jsx("div",{className:"bg-gray-50 min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold leading-7 text-gray-900 sm:text-3xl sm:truncate",children:"Users Management"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Manage all users, outlets, and administrators on the platform"})]}),$&&e.jsx("div",{className:"bg-green-50 border-l-4 border-green-500 p-4 mb-6",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-green-500",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-green-700",children:$})})]})}),U&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 mb-6",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Z,{className:"h-5 w-5 text-red-500"})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-700",children:U})})]})}),e.jsx("div",{className:"bg-white shadow rounded-lg mb-6",children:e.jsx("div",{className:"px-4 py-5 sm:p-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"search",className:"block text-sm font-medium text-gray-700 sr-only",children:"Search"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ee,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",name:"search",id:"search",className:"focus:ring-orange-500 focus:border-orange-500 block w-full pl-10 sm:text-sm border-gray-300 rounded-md",placeholder:"Search by name, email, or outlet name",value:f,onChange:B})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700",children:"Role"}),e.jsxs("select",{id:"role",name:"role",className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md",value:j,onChange:D,children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"outlet",children:"Outlet Owner"}),e.jsx("option",{value:"user",children:"Customer"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Status"}),e.jsxs("select",{id:"status",name:"status",className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md",value:v,onChange:H,children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})]})})}),e.jsxs("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:[N&&g.length>0&&e.jsx("div",{className:"px-4 py-2 bg-gray-50 border-b border-gray-200",children:e.jsxs("div",{className:"flex justify-center",children:[e.jsx(T,{size:"sm"}),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:"Refreshing data..."})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Joined"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Login"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Orders"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:g.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No users found matching your criteria"})}):g.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-600 font-medium",children:t.name?t.name.charAt(0).toUpperCase():"?"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.name}),e.jsx("div",{className:"text-sm text-gray-500",children:t.email}),t.outletName&&e.jsx("div",{className:"text-xs text-orange-600",children:t.outletName})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${G(t.role)}`,children:C(t.usersRole)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${K(t.status)}`,children:t.status?t.status.charAt(0).toUpperCase()+t.status.slice(1):"Unknown"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:A(t.createdAt)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.lastLogin?A(t.lastLogin):"Never"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.ordersCount}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(E,{to:`/admin/users/${t._id}`,className:"p-2 text-orange-600 hover:text-orange-900 hover:bg-orange-50 rounded-md transition-colors",title:"View Details",children:e.jsx(te,{className:"h-5 w-5"})}),e.jsx(E,{to:`/admin/users/${t._id}/edit`,className:"p-2 text-blue-600 hover:text-blue-900 hover:bg-blue-50 rounded-md transition-colors",title:"Edit User",children:e.jsx(ne,{className:"h-5 w-5"})}),t.usersRole!=="admin"&&e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:t.usersRole,onChange:s=>V(t._id,s.target.value),disabled:x,className:`px-3 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 bg-white text-gray-700 hover:bg-gray-50 transition-colors ${x?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"outlet",children:"Outlet"})]}),e.jsx("button",{type:"button",onClick:()=>J(t._id,t.status==="active"?"inactive":"active"),disabled:x||t.usersRole==="admin",className:`p-2 ${t.status==="active"?"text-red-600 hover:text-red-900 hover:bg-red-50":"text-green-600 hover:text-green-900 hover:bg-green-50"} rounded-md transition-colors ${x?"opacity-50 cursor-not-allowed":""}`,title:t.status==="active"?"Deactivate User":"Activate User",children:t.status==="active"?e.jsx(ie,{className:"h-5 w-5"}):e.jsx(le,{className:"h-5 w-5"})}),e.jsx("button",{type:"button",onClick:()=>X(t._id),disabled:x,className:`p-2 text-red-600 hover:text-red-900 hover:bg-red-50 rounded-md transition-colors ${x?"opacity-50 cursor-not-allowed":""}`,title:"Delete User",children:e.jsx(se,{className:"h-5 w-5"})})]})]})})]},t._id))})]})}),c.totalPages>1&&e.jsx("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6",children:e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing ",e.jsx("span",{className:"font-medium",children:(l-1)*m+1})," to ",e.jsx("span",{className:"font-medium",children:Math.min(l*m,c.total)})," of"," ",e.jsx("span",{className:"font-medium",children:c.total})," results"]})}),e.jsx("div",{children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[e.jsxs("button",{onClick:q,disabled:l===1,className:`relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium ${l===1?"text-gray-300 cursor-not-allowed":"text-gray-500 hover:bg-gray-50"}`,children:[e.jsx("span",{className:"sr-only",children:"Previous"}),e.jsx(ae,{className:"h-5 w-5","aria-hidden":"true"})]}),Array.from({length:c.totalPages},(t,s)=>s+1).map(t=>e.jsx("button",{onClick:()=>d(t),className:`relative inline-flex items-center px-4 py-2 border ${t===l?"z-10 bg-orange-50 border-orange-500 text-orange-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"} text-sm font-medium`,children:t},t)),e.jsxs("button",{onClick:I,disabled:l===c.totalPages,className:`relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium ${l===c.totalPages?"text-gray-300 cursor-not-allowed":"text-gray-500 hover:bg-gray-50"}`,children:[e.jsx("span",{className:"sr-only",children:"Next"}),e.jsx(re,{className:"h-5 w-5","aria-hidden":"true"})]})]})})]})})]})]})})};export{me as default};
