import{A as J,a as K,r as c,j as e,B as l,n as Q,I as W,g as X,p as T,q as _,s as M,t as F,v as i,c as Y,E as $,R as D,T as O,S as ee,e as v}from"./index-CW7sJ-MG.js";import{S as I}from"./square-pen-C0ENrl1l.js";const x=10,ce=()=>{const h=J(),{currentUser:se}=K(s=>s.user),[u,y]=c.useState([]),[L,P]=c.useState([]),[j,S]=c.useState(""),[m,k]=c.useState("newest"),[g,A]=c.useState("all"),[r,n]=c.useState(1),[o,E]=c.useState(1),[w,z]=c.useState(0),[q,f]=c.useState(!1),[b,N]=c.useState(null),[te,ae]=c.useState(""),[B,p]=c.useState(!1);c.useEffect(()=>{(async()=>{try{const t=await fetch("/api/route/allcategories"),a=await t.json();if(!t.ok)throw new Error(a.message||"Failed to fetch categories");P(Array.isArray(a.allCategory)?a.allCategory:[])}catch(t){v.error("Error loading categories"),P([]),console.error(t)}})()},[]);const R=async s=>{if(s)try{p(!0);const t=await fetch(`/api/route/delete/${s}`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include"}),a=await t.json();if(!t.ok)throw new Error(a.message||"Failed to delete product");y(C=>C.filter(G=>G._id!==s)),v.success("Product deleted successfully"),f(!1),N(null);const d=w-1;z(d),E(Math.ceil(d/x)),u.length===1&&r>1&&n(C=>C-1)}catch(t){console.error("Delete product error:",t),v.error(t.message||"Error deleting product")}finally{p(!1)}};c.useEffect(()=>{(async()=>{try{p(!0);const t=new URLSearchParams({startIndex:(r-1)*x,limit:x,...j&&{searchTerm:j},order:m.includes("asc")?"asc":"desc",sort:m.includes("price")?"productPrice":m.includes("name")?"productName":m.includes("category")?"category":m.includes("stock")?"numberOfProductsAvailable":"updatedAt",...g!=="all"&&{category:g}}),a=await fetch(`/api/route/allproducts?${t.toString()}`),d=await a.json();if(!a.ok)throw new Error(d.message||"Failed to fetch products");y(Array.isArray(d.products)?d.products:[]),z(d.totalProducts||0),E(Math.ceil((d.totalProducts||0)/x))}catch(t){console.error(t),v.error("Error loading products"),y([])}finally{p(!1)}})()},[j,m,g,r]);const H=s=>{S(s.target.value),n(1)},U=s=>{k(s),n(1)},Z=s=>{A(s),n(1)},V=()=>{S(""),A("all"),k("newest"),n(1)};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Manage Products"}),e.jsxs(l,{onClick:()=>h("/outlet/product/new"),className:"bg-orange-500 text-white",children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"Add New Product"]})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(W,{type:"text",placeholder:"Search products...",value:j,onChange:H,className:"pl-10"}),e.jsx(X,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]}),e.jsxs(T,{value:g,onValueChange:Z,children:[e.jsx(_,{children:e.jsx(M,{placeholder:"Filter by category"})}),e.jsxs(F,{children:[e.jsx(i,{value:"all",children:"All Categories"}),L.map(s=>e.jsx(i,{value:s.categoryName,children:s.categoryName},s._id))]})]}),e.jsxs(T,{value:m,onValueChange:U,children:[e.jsx(_,{children:e.jsx(M,{placeholder:"Sort by"})}),e.jsxs(F,{children:[e.jsx(i,{value:"newest",children:"Newest"}),e.jsx(i,{value:"oldest",children:"Oldest"}),e.jsx(i,{value:"price-asc",children:"Price: Low to High"}),e.jsx(i,{value:"price-desc",children:"Price: High to Low"}),e.jsx(i,{value:"name-asc",children:"Name: A-Z"}),e.jsx(i,{value:"name-desc",children:"Name: Z-A"}),e.jsx(i,{value:"category-asc",children:"Category: A-Z"}),e.jsx(i,{value:"category-desc",children:"Category: Z-A"}),e.jsx(i,{value:"stock-asc",children:"Stock: Low to High"}),e.jsx(i,{value:"stock-desc",children:"Stock: High to Low"})]})]}),e.jsx(l,{onClick:V,variant:"outline",className:"w-full",children:"Clear Filters"})]})}),B?e.jsx("div",{className:"text-center py-10",children:e.jsx(Y,{size:"lg"})}):u.length>0?e.jsxs("div",{children:[e.jsx("div",{className:"hidden sm:block bg-white p-4 rounded-lg shadow overflow-x-auto",children:e.jsxs("table",{className:"w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 text-left text-sm font-medium text-gray-600 uppercase",children:[e.jsx("th",{className:"p-3",children:"Product"}),e.jsx("th",{className:"p-3",children:"Category"}),e.jsx("th",{className:"p-3",children:"Price"}),e.jsx("th",{className:"p-3",children:"Stock"}),e.jsx("th",{className:"p-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{children:u.map(s=>{var t;return e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsx("img",{src:s.productImage||"https://via.placeholder.com/40",alt:"",className:"h-10 w-10 rounded object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:s.productName}),e.jsx("p",{className:"text-xs text-gray-500 truncate max-w-xs",children:s.description||"No description"})]})]})}),e.jsx("td",{className:"p-3 text-sm",children:((t=s.category)==null?void 0:t.categoryName)||s.category||"Uncategorized"}),e.jsxs("td",{className:"p-3 text-sm",children:["₵",s.productPrice.toFixed(2)]}),e.jsx("td",{className:"p-3 text-sm",children:s.numberOfProductsAvailable}),e.jsxs("td",{className:"p-3 flex justify-end gap-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>h(`/outlet/product/${s._id}`),children:e.jsx($,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>h(`/outlet/product/${s._id}/edit`),children:e.jsx(I,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>h(`/outlet/restock?productId=${s._id}&quantity=${s.numberOfProductsAvailable}`),children:e.jsx(D,{className:"h-4 w-4 text-green-500"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{f(!0),N(s)},children:e.jsx(O,{className:"h-4 w-4 text-red-500"})})]})]},s._id)})})]})}),e.jsx("div",{className:"sm:hidden grid grid-cols-2 gap-4",children:u.map(s=>{var t;return e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[e.jsxs("div",{className:"flex flex-col items-center mb-3",children:[e.jsx("img",{src:s.productImage||"https://via.placeholder.com/40",alt:"",className:"h-16 w-16 rounded object-cover mb-2"}),e.jsx("h3",{className:"text-sm font-semibold text-center",children:s.productName})]}),e.jsx("div",{className:"text-xs text-gray-500 mb-2 text-center truncate",children:s.description||"No description"}),e.jsxs("div",{className:"flex justify-between items-center text-xs mb-2",children:[e.jsx("span",{children:"Category:"}),e.jsx("span",{className:"font-medium",children:((t=s.category)==null?void 0:t.categoryName)||s.category||"Uncategorized"})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs mb-2",children:[e.jsx("span",{children:"Price:"}),e.jsxs("span",{className:"font-medium",children:["₵",s.productPrice.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs mb-3",children:[e.jsx("span",{children:"Stock:"}),e.jsx("span",{className:"font-medium",children:s.numberOfProductsAvailable})]}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>h(`/outlet/product/${s._id}`),children:e.jsx($,{className:"h-3 w-3"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>h(`/outlet/product/${s._id}/edit`),children:e.jsx(I,{className:"h-3 w-3"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>h(`/outlet/restock?productId=${s._id}&quantity=${s.numberOfProductsAvailable}`),children:e.jsx(D,{className:"h-3 w-3 text-green-500"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{f(!0),N(s)},children:e.jsx(O,{className:"h-3 w-3 text-red-500"})})]})]},s._id)})})]}):e.jsxs("div",{className:"text-center py-10 text-gray-500",children:[e.jsx(ee,{className:"mx-auto h-12 w-12 mb-2"}),e.jsx("p",{children:"No products found. Add your first product to get started."})]}),o>1&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"hidden md:flex justify-between items-center bg-white p-4 rounded-lg shadow",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",(r-1)*x+1," to ",Math.min(r*x,w)," of ",w," products"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>n(s=>Math.max(s-1,1)),disabled:r===1,children:"Previous"}),Array.from({length:Math.min(5,o)},(s,t)=>{let a;return o<=5||r<=3?a=t+1:r>=o-2?a=o-4+t:a=r-2+t,e.jsx(l,{variant:r===a?"default":"outline",size:"sm",onClick:()=>n(a),className:r===a?"bg-orange-500":"",children:a},a)}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>n(s=>Math.min(s+1,o)),disabled:r===o,children:"Next"})]})]}),e.jsxs("div",{className:"md:hidden bg-white p-4 rounded-lg shadow",children:[e.jsxs("div",{className:"text-sm text-gray-500 text-center mb-3",children:["Page ",r," of ",o]}),e.jsxs("div",{className:"flex justify-center space-x-3",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>n(s=>Math.max(s-1,1)),disabled:r===1,className:"flex-1",children:"Previous"}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>n(s=>Math.min(s+1,o)),disabled:r===o,className:"flex-1",children:"Next"})]})]})]}),q&&b&&e.jsx("div",{className:"fixed inset-0 bg-black/80 bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-full max-w-sm",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Confirm Deletion"}),e.jsxs("p",{className:"mb-4",children:['Are you sure you want to delete "',b.productName,'"? This action cannot be undone.']}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(l,{variant:"outline",onClick:()=>{f(!1),N(null)},children:"Cancel"}),e.jsx(l,{variant:"destructive",onClick:()=>R(b._id),children:"Delete"})]})]})})]})};export{ce as default};
