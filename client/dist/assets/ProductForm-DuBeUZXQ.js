import{a as V,A as W,r as n,j as e,I as x,a2 as H,p as J,q as Q,s as X,t as G,v as K,e as m,X as L,n as Y}from"./index-CW7sJ-MG.js";import{T as Z}from"./textarea-B1GM8hMp.js";import{L as k}from"./loader-BXkacTqF.js";const ae=()=>{const{currentUser:c}=V(t=>t.user),N=W(),[P,S]=n.useState(!1),[C,u]=n.useState(null),[F,q]=n.useState([]),[I,$]=n.useState(!1),[r,g]=n.useState({title:"",description:"",price:"",discountPrice:"",stock:"",category:"",specifications:[],featured:!1}),[l,h]=n.useState({}),[p,A]=n.useState({key:"",value:""}),[f,v]=n.useState([]),[j,w]=n.useState([]),[b,E]=n.useState(!1);n.useEffect(()=>{(async()=>{if(!c){u("Please log in to add a product"),m.error("Please log in to add a product");return}try{$(!0);const s=await fetch("/api/route/allcategories",{headers:{Authorization:`Bearer ${c==null?void 0:c.token}`}});if(!s.ok)throw new Error(`HTTP error ${s.status}: ${s.statusText}`);const a=await s.json(),i=Array.isArray(a.allCategory)?a.allCategory.map(d=>({_id:d._id,name:d.categoryName,image:d.image})):[];console.log("Categories fetched:",i),q(i)}catch(s){console.error("Fetch categories error:",s.message),u("Failed to load categories"),m.error("Failed to load categories")}finally{$(!1)}})()},[c]);const y=t=>{const{name:s,value:a,type:i,checked:d}=t.target;i==="checkbox"?g(o=>({...o,[s]:d})):s==="price"||s==="discountPrice"||s==="stock"?(a===""||/^\d*\.?\d*$/.test(a))&&g(o=>({...o,[s]:a})):g(o=>({...o,[s]:a})),l[s]&&h(o=>({...o,[s]:null}))},D=t=>{const s=Array.from(t.target.files);if(s.length===0)return;if(f.length+s.length>5){u("Maximum 5 images allowed."),m.error("Maximum 5 images allowed.");return}const a=[...f,...s];v(a);const i=[];s.forEach(d=>{const o=new FileReader;o.onloadend=()=>{i.push(o.result),i.length===s.length&&w(M=>[...M,...i])},o.readAsDataURL(d)}),l.images&&h(d=>({...d,images:null}))},R=t=>{const s=[...f],a=[...j];a[t].startsWith("blob:")&&URL.revokeObjectURL(a[t]),s.splice(t,1),a.splice(t,1),v(s),w(a),a.length===0&&h(i=>({...i,images:"At least one image required"}))},T=t=>{const{name:s,value:a}=t.target;A(i=>({...i,[s]:a}))},B=()=>{!p.key.trim()||!p.value.trim()||(g(t=>({...t,specifications:[...t.specifications,{...p}]})),A({key:"",value:""}))},O=t=>{g(s=>({...s,specifications:s.specifications.filter((a,i)=>i!==t)}))},_=async()=>{if(f.length===0)return null;E(!0);const t=new FormData;f.forEach(s=>t.append("images",s));try{const s=await fetch("/api/route/upload",{method:"POST",headers:{Authorization:`Bearer ${c==null?void 0:c.token}`},body:t});if(!s.ok)throw new Error(`HTTP error ${s.status}: ${s.statusText}`);const a=await s.json();if(!a.success)throw new Error(a.message||"Image upload failed");return a.images[0].filePath}catch(s){return console.error("Error uploading images:",s),u(s.message),m.error(s.message),null}finally{E(!1)}},z=()=>{const t={};return r.title.trim()||(t.title="Product title is required"),r.price||(t.price="Price is required"),r.stock||(t.stock="Stock quantity is required"),r.category||(t.category="Category is required"),f.length===0&&(t.images="At least one image must be uploaded"),h(t),Object.keys(t).length===0},U=async t=>{if(t.preventDefault(),!c){u("Please log in to add a product"),m.error("Please log in to add a product");return}if(!z()){const s=document.querySelector(".error-message");s&&s.scrollIntoView({behavior:"smooth",block:"center"}),m.error("Please fill all required fields");return}if(!b){S(!0),u(null);try{const s=await _();if(!s){h(o=>({...o,images:"Image upload failed"})),m.error("Image upload failed");return}const a={productName:r.title,category:r.category,numberOfProductsAvailable:parseInt(r.stock,10),productPrice:parseFloat(r.price),discountPrice:r.discountPrice?parseFloat(r.discountPrice):void 0,description:r.description,specifications:r.specifications.map(o=>`${o.key}: ${o.value}`),featured:r.featured,productImage:s,outlet:c._id||void 0},i=await fetch("/api/route/products",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c.token}`},body:JSON.stringify(a)}),d=await i.json();if(!i.ok)throw new Error(d.message||"Failed to create product");g({title:"",description:"",price:"",discountPrice:"",stock:"",category:"",specifications:[],featured:!1}),v([]),w([]),m.success("Product created successfully!"),N("/outlet/products")}catch(s){u(s.message),m.error(s.message)}finally{S(!1)}}};return e.jsx("div",{className:"bg-gray-50 min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"md:flex md:items-center md:justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 sm:text-3xl",children:"Add New Product"}),e.jsx("button",{type:"button",onClick:()=>N("/outlet/products"),className:"mt-4 md:mt-0 md:ml-4 inline-flex items-center px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Cancel"})]}),C&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 mb-6",children:e.jsxs("div",{className:"flex",children:[e.jsx("svg",{className:"h-5 w-5 text-red-500",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),e.jsx("p",{className:"ml-3 text-sm text-red-700",children:C})]})}),I&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(k,{className:"animate-spin h-6 w-6 text-gray-500"})}),!I&&F.length===0&&e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-500 p-4 mb-6",children:e.jsx("p",{className:"text-sm text-yellow-700",children:"No categories available. Please add categories first."})}),e.jsxs("form",{onSubmit:U,className:"space-y-8",children:[e.jsxs("div",{className:"bg-white shadow sm:rounded-lg",children:[e.jsxs("div",{className:"px-4 py-5 sm:px-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Basic Information"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Product details and information."})]}),e.jsx("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6",children:[e.jsxs("div",{className:"sm:col-span-4",children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"Product Title *"}),e.jsx(x,{type:"text",name:"title",id:"title",value:r.title,onChange:y,className:`block w-full sm:text-sm border-gray-300 rounded-md ${l.title?"border-red-300":""}`}),l.title&&e.jsx("p",{className:"mt-2 text-sm text-red-600 error-message",children:l.title})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(H,{htmlFor:"category",children:"Category *"}),e.jsxs(J,{value:r.category,onValueChange:t=>{g(s=>({...s,category:t})),l.category&&h(s=>({...s,category:null}))},children:[e.jsx(Q,{className:`w-full ${l.category?"border-red-300":""}`,children:e.jsx(X,{placeholder:"Select a category"})}),e.jsx(G,{children:F.map(t=>e.jsx(K,{value:t._id,children:t.name},t._id))})]}),l.category&&e.jsx("p",{className:"mt-2 text-sm text-red-600 error-message",children:l.category})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx(Z,{id:"description",name:"description",value:r.description,onChange:y,placeholder:"Write a detailed description of your product",className:`min-h-[100px] ${l.description?"border-red-500":""}`}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Write a detailed description of your product."})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{htmlFor:"price",className:"block text-sm font-medium text-gray-700",children:"Price (₦) *"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500 sm:text-sm",children:"₦"}),e.jsx(x,{type:"text",name:"price",id:"price",value:r.price,onChange:y,className:`block w-full pl-7 pr-12 sm:text-sm border-gray-300 rounded-md ${l.price?"border-red-300":""}`,placeholder:"0"})]}),l.price&&e.jsx("p",{className:"mt-2 text-sm text-red-600 error-message",children:l.price})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{htmlFor:"discountPrice",className:"block text-sm font-medium text-gray-700",children:"Discount Price (₦)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500 sm:text-sm",children:"₦"}),e.jsx(x,{type:"text",name:"discountPrice",id:"discountPrice",value:r.discountPrice,onChange:y,className:`block w-full pl-7 pr-12 sm:text-sm border-gray-300 rounded-md ${l.discountPrice?"border-red-300":""}`,placeholder:"0"})]}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Leave empty if no discount"})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{htmlFor:"stock",className:"block text-sm font-medium text-gray-700",children:"Stock Quantity *"}),e.jsx(x,{type:"text",name:"stock",id:"stock",value:r.stock,onChange:y,className:`block w-full sm:text-sm border-gray-300 rounded-md ${l.stock?"border-red-300":""}`,placeholder:"0"}),l.stock&&e.jsx("p",{className:"mt-2 text-sm text-red-600 error-message",children:l.stock})]}),e.jsx("div",{className:"sm:col-span-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(x,{id:"featured",name:"featured",type:"checkbox",checked:r.featured,onChange:y,className:"h-4 w-4 text-orange-600 border-gray-300 rounded"}),e.jsxs("div",{className:"ml-3 text-sm",children:[e.jsx("label",{htmlFor:"featured",className:"font-medium text-gray-700",children:"Featured Product"}),e.jsx("p",{className:"text-gray-500",children:"Featured products appear on the homepage."})]})]})})]})})]}),e.jsxs("div",{className:"bg-white shadow sm:rounded-lg",children:[e.jsxs("div",{className:"px-4 py-5 sm:px-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Product Images"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Upload at least one image of your product (up to 5)."})]}),e.jsx("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"file-upload",className:"block text-sm font-medium text-gray-700",children:"Images * (at least one required)"}),e.jsx(x,{id:"file-upload",name:"file-upload",type:"file",accept:"image/*",multiple:!0,onChange:D,disabled:b||j.length>=5,className:"cursor-pointer"}),l.images&&e.jsx("p",{className:"mt-2 text-sm text-red-600 error-message",children:l.images}),b&&e.jsxs("p",{className:"mt-2 text-sm text-gray-500 flex items-center",children:[e.jsx(k,{className:"animate-spin h-4 w-4 mr-2"}),"Uploading images..."]})]}),j.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Image Previews"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:j.map((t,s)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t,alt:`Preview ${s+1}`,className:"rounded-lg shadow-md max-w-[150px]",onError:()=>m.error(`Failed to load image ${s+1}`)}),e.jsx("button",{type:"button",onClick:()=>R(s),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:e.jsx(L,{className:"h-4 w-4"})})]},s))})]})]})})]}),e.jsxs("div",{className:"bg-white shadow sm:rounded-lg",children:[e.jsxs("div",{className:"px-4 py-5 sm:px-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Product Specifications"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Add key specifications for your product."})]}),e.jsx("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{htmlFor:"spec-key",className:"block text-sm font-medium text-gray-700",children:"Specification"}),e.jsx(x,{type:"text",id:"spec-key",name:"key",value:p.key,onChange:T,className:"block w-full sm:text-sm border-gray-300 rounded-md",placeholder:"e.g. Brand, Weight"})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"spec-value",className:"block text-sm font-medium text-gray-700",children:"Value"}),e.jsx(x,{type:"text",id:"spec-value",name:"value",value:p.value,onChange:T,className:"block w-full sm:text-sm border-gray-300 rounded-md",placeholder:"e.g. Samsung, 500g"})]}),e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 invisible",children:"Action"}),e.jsxs("button",{type:"button",onClick:B,className:"mt-1 inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-orange-500 hover:bg-orange-600",disabled:!p.key.trim()||!p.value.trim(),children:[e.jsx(Y,{className:"-ml-0.5 mr-2 h-4 w-4"}),"Add"]})]})]}),r.specifications.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Added Specifications"}),e.jsx("div",{className:"bg-gray-50 rounded-md",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:r.specifications.map((t,s)=>e.jsxs("li",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[t.key,": "]}),e.jsx("span",{className:"text-sm text-gray-500",children:t.value})]}),e.jsx("button",{type:"button",onClick:()=>O(s),className:"text-red-500 hover:text-red-600",children:e.jsx(L,{className:"h-4 w-4"})})]},s))})})]})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>N("/outlet/products"),className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:P||b,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-orange-500 hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed",children:P?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"-ml-1 mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save Product"})]})]})]})})};export{ae as default};
