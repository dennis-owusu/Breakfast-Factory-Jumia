import{a as C,r as c,e as S,j as e,g as O,c as F,P as $,L as v,f as T,d as E,E as U,h as I,C as _}from"./index-CW7sJ-MG.js";import{l as A}from"./index-BLRFddlS.js";import{F as L}from"./funnel-DV1gsmvk.js";const w=async(n=1,d=10,g="",o={})=>{try{const x=(n-1)*d;let i=`http://localhost:3000/api/route/getOrdersByUser/${currentUser._id}?startIndex=${x}&limit=${d}`;g&&(i+=`&searchTerm=${encodeURIComponent(g)}`),o.status&&o.status!=="all"&&(i+=`&status=${o.status}`),o.dateFrom&&(i+=`&dateFrom=${o.dateFrom}`),o.dateTo&&(i+=`&dateTo=${o.dateTo}`);const p=await fetch(i,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${currentUser.token}`}});if(!p.ok)throw new Error(`HTTP error ${p.status}`);const t=await p.json();return{orders:t.orders,pagination:{page:n,limit:d,totalOrders:t.totalOrders,totalPages:Math.ceil(t.totalOrders/d)}}}catch(x){throw console.error("Error fetching orders:",x),x}},M=()=>{const{currentUser:n}=C(s=>s.user),[d,g]=c.useState([]),[o,x]=c.useState(!0),[i,p]=c.useState(null),[t,h]=c.useState({page:1,limit:10,totalOrders:0,totalPages:0}),[m,b]=c.useState(""),[a,N]=c.useState({status:"all",dateFrom:"",dateTo:""});c.useEffect(()=>{if(n&&n.token){console.log("Setting up Socket.IO connection for user:",n._id);const s=A("http://localhost:3000",{auth:{token:n.token}});return s.on("connect",()=>{console.log("Socket connected for user orders. Socket ID:",s.id),console.log("User should be in room:",n._id)}),s.on("orderStatusUpdated",r=>{console.log("Received order status update:",r),console.log("Current orders before update:",d),g(l=>{const u=l.map(j=>j._id===r.orderId?{...j,status:r.newStatus}:j);return console.log("Orders after update:",u),u}),S.success(r.message)}),s.on("connect_error",r=>{console.error("Socket connection error:",r.message)}),s.on("disconnect",r=>{console.log("Socket disconnected from user orders. Reason:",r)}),()=>{console.log("Cleaning up socket connection for user orders"),s.disconnect()}}},[n]),c.useEffect(()=>{(async()=>{x(!0);try{const r=await w(t.page,t.limit,m,a);g(r.orders),h(r.pagination),p(null)}catch(r){console.error("Error fetching orders:",r),p("Failed to fetch orders. Please try again.")}finally{x(!1)}})()},[t.page,t.limit,m,a]),c.useEffect(()=>{const r=setInterval(async()=>{try{const l=await w(t.page,t.limit,m,a);g(l.orders),h(l.pagination)}catch(l){console.error("Polling error:",l)}},3e4);return()=>clearInterval(r)},[t.page,t.limit,m,a]);const k=s=>{b(s.target.value),h(r=>({...r,page:1}))},f=s=>{const{name:r,value:l}=s.target;N(u=>({...u,[r]:l})),h(u=>({...u,page:1}))},y=s=>{s>0&&s<=t.totalPages&&h(r=>({...r,page:s}))},P=s=>{switch(s){case"delivered":return"bg-green-100 text-green-800";case"processing":return"bg-blue-100 text-blue-800";case"shipped":return"bg-purple-100 text-purple-800";case"pending":return"bg-yellow-100 text-yellow-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"My Orders"}),e.jsx("p",{className:"text-gray-600",children:"View and track your order history"})]}),e.jsx("div",{className:"mb-6 bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(O,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Search orders by number or product...",className:"pl-10 pr-4 py-2 border border-gray-300 rounded-md w-full focus:ring-orange-500 focus:border-orange-500",value:m,onChange:k})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(L,{className:"h-5 w-5 text-gray-400"})}),e.jsxs("select",{name:"status",className:"pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500",value:a.status,onChange:f,children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",name:"dateFrom",className:"px-3 py-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500",value:a.dateFrom,onChange:f,placeholder:"From"}),e.jsx("span",{className:"text-gray-500",children:"to"}),e.jsx("input",{type:"date",name:"dateTo",className:"px-3 py-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500",value:a.dateTo,onChange:f,placeholder:"To"})]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:o?e.jsx("div",{className:"p-8 flex justify-center",children:e.jsx(F,{})}):i?e.jsx("div",{className:"p-8 text-center text-red-500",children:i}):d.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx($,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"No orders found"}),e.jsx("p",{className:"text-gray-500 mt-2",children:m||a.status!=="all"||a.dateFrom||a.dateTo?"Try adjusting your search or filters":"You haven't placed any orders yet"}),(m||a.status!=="all"||a.dateFrom||a.dateTo)&&e.jsx("button",{onClick:()=>{b(""),N({status:"all",dateFrom:"",dateTo:""})},className:"mt-4 px-4 py-2 bg-orange-100 text-orange-600 rounded-md hover:bg-orange-200 transition-colors",children:"Clear Filters"}),e.jsx(v,{to:"/products",className:"mt-4 inline-block px-4 py-2 bg-orange-500 text-white rounded-md hover:bg-orange-600 transition-colors",children:"Browse Products"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Order"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Items"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:d.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.orderNumber})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:T(s.createdAt)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${P(s.status)}`,children:s.status.charAt(0).toUpperCase()+s.status.slice(1)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:E(s.totalPrice)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("img",{className:"h-10 w-10 rounded-full object-cover",src:s.products[0].product.images[0]||"https://via.placeholder.com/150",alt:s.products[0].product.name})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.products[0].product.name}),s.products.length>1&&e.jsxs("div",{className:"text-sm text-gray-500",children:["+",s.products.length-1," more item(s)"]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs(v,{to:`/user/orders/${s._id}`,className:"text-orange-600 hover:text-orange-900 flex items-center justify-end gap-1",children:[e.jsx("span",{children:"View"}),e.jsx(U,{className:"h-4 w-4"})]})})]},s._id))})]})}),t.totalPages>1&&e.jsxs("div",{className:"px-6 py-4 flex items-center justify-between border-t border-gray-200",children:[e.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>y(t.page-1),disabled:t.page===1,className:`relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md ${t.page===1?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50"}`,children:"Previous"}),e.jsx("button",{onClick:()=>y(t.page+1),disabled:t.page===t.totalPages,className:`relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md ${t.page===t.totalPages?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50"}`,children:"Next"})]}),e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing ",e.jsx("span",{className:"font-medium",children:(t.page-1)*t.limit+1})," to ",e.jsx("span",{className:"font-medium",children:Math.min(t.page*t.limit,t.totalOrders)})," of ",e.jsx("span",{className:"font-medium",children:t.totalOrders})," results"]})}),e.jsx("div",{children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[e.jsxs("button",{onClick:()=>y(t.page-1),disabled:t.page===1,className:`relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 text-sm font-medium ${t.page===1?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-500 hover:bg-gray-50"}`,children:[e.jsx("span",{className:"sr-only",children:"Previous"}),e.jsx(I,{className:"h-5 w-5"})]}),[...Array(t.totalPages).keys()].map(s=>{const r=s+1;return r===1||r===t.totalPages||Math.abs(r-t.page)<=1?e.jsx("button",{onClick:()=>y(r),className:`relative inline-flex items-center px-4 py-2 border ${r===t.page?"bg-orange-50 border-orange-500 text-orange-600 z-10":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"} text-sm font-medium`,children:r},r):r===2||r===t.totalPages-1?e.jsx("span",{className:"relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700",children:"..."},`ellipsis-${r}`):null}),e.jsxs("button",{onClick:()=>y(t.page+1),disabled:t.page===t.totalPages,className:`relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 text-sm font-medium ${t.page===t.totalPages?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-500 hover:bg-gray-50"}`,children:[e.jsx("span",{className:"sr-only",children:"Next"}),e.jsx(_,{className:"h-5 w-5"})]})]})})]})]})]})})]})};export{M as default};
