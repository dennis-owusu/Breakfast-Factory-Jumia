import{r,j as e,c as P,a6 as T,g as R,P as q,f as B,d as G,L as H,E as J,h as K,C as Q}from"./index-CW7sJ-MG.js";import{C as k}from"./calendar-C6BTQIk3.js";const V=async n=>{try{const h=localStorage.getItem("token"),u=new URLSearchParams({startIndex:((n.page-1)*n.limit).toString(),limit:n.limit.toString(),searchTerm:n.search||"",status:n.status!=="all"?n.status:"",dateFrom:n.startDate||"",dateTo:n.endDate||""}),g=await fetch(`/api/route/getOrders?${u}`,{headers:{Authorization:`Bearer ${h}`}});if(!g.ok)throw new Error("Failed to fetch orders");const d=await g.json();return{orders:d.map(s=>{var m,p;return{_id:s._id,orderNumber:s.orderNumber,customer:{_id:s.user,name:((m=s.userInfo)==null?void 0:m.name)||"Unknown",email:(p=s.userInfo)==null?void 0:p.email,phone:s.phoneNumber},items:s.products.map(l=>{var y,x,j,a;return{_id:l._id,product:{name:(y=l.product)==null?void 0:y.name,image:(j=(x=l.product)==null?void 0:x.images)==null?void 0:j[0]},price:(a=l.product)==null?void 0:a.price,quantity:l.quantity}}),shippingAddress:{street:s.address,city:s.city,state:s.state,country:"Ghana",zipCode:s.postalCode},paymentMethod:s.paymentMethod,paymentStatus:s.momoTransactionId?"paid":"pending",totalAmount:s.totalPrice,status:s.status,createdAt:s.createdAt,updatedAt:s.updatedAt}}),pagination:{total:d.length,totalPages:Math.ceil(d.length/n.limit),currentPage:n.page,limit:n.limit}}}catch(h){throw new Error("Failed to fetch orders: "+h.message)}},Y=()=>{const[n,h]=r.useState(""),[u,g]=r.useState("all"),[d,s]=r.useState("all"),[m,p]=r.useState("all"),[l,y]=r.useState(""),[x,j]=r.useState(""),[a,i]=r.useState(1),[f]=r.useState(10),[v,C]=r.useState([]),[o,D]=r.useState({total:0,totalPages:0,currentPage:1,limit:10}),[b,N]=r.useState(!0),[w,S]=r.useState(null);r.useEffect(()=>{(async()=>{try{N(!0);const c=await V({search:n,status:u,paymentStatus:d,paymentMethod:m,startDate:l,endDate:x,page:a,limit:f});C(c.orders),D(c.pagination),S(null)}catch{S("Failed to load orders. Please try again later.")}finally{N(!1)}})()},[n,u,d,m,l,x,a,f]);const A=t=>{h(t.target.value),i(1)},M=t=>{g(t.target.value),i(1)},_=t=>{s(t.target.value),i(1)},E=t=>{p(t.target.value),i(1)},F=t=>{y(t.target.value),i(1)},O=t=>{j(t.target.value),i(1)},L=()=>{a>1&&i(a-1)},$=()=>{a<o.totalPages&&i(a+1)},U=t=>{switch(t){case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-blue-100 text-blue-800";case"shipped":return"bg-purple-100 text-purple-800";case"delivered":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},z=t=>{switch(t){case"paid":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"refunded":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},I=t=>{switch(t){case"cash_on_delivery":return"Cash on Delivery";case"paystack":return"Paystack";default:return t.split("_").map(c=>c.charAt(0).toUpperCase()+c.slice(1)).join(" ")}};return b&&v.length===0?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx(P,{size:"lg"})}):e.jsx("div",{className:"bg-gray-50 min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold leading-7 text-gray-900 sm:text-3xl sm:truncate",children:"Orders Management"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Manage all orders on the platform"})]}),w&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 mb-6",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(T,{className:"h-5 w-5 text-red-500"})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-700",children:w})})]})}),e.jsx("div",{className:"bg-white shadow rounded-lg mb-6",children:e.jsx("div",{className:"px-4 py-5 sm:p-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"search",className:"block text-sm font-medium text-gray-700 sr-only",children:"Search"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(R,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",name:"search",id:"search",className:"focus:ring-orange-500 focus:border-orange-500 block w-full pl-10 sm:text-sm border-gray-300 rounded-md",placeholder:"Search by order #, customer, or product",value:n,onChange:A})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Order Status"}),e.jsxs("select",{id:"status",name:"status",className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md",value:u,onChange:M,children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"paymentStatus",className:"block text-sm font-medium text-gray-700",children:"Payment Status"}),e.jsxs("select",{id:"paymentStatus",name:"paymentStatus",className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md",value:d,onChange:_,children:[e.jsx("option",{value:"all",children:"All Payment Status"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"refunded",children:"Refunded"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"paymentMethod",className:"block text-sm font-medium text-gray-700",children:"Payment Method"}),e.jsxs("select",{id:"paymentMethod",name:"paymentMethod",className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md",value:m,onChange:E,children:[e.jsx("option",{value:"all",children:"All Payment Methods"}),e.jsx("option",{value:"cash_on_delivery",children:"Cash on Delivery"}),e.jsx("option",{value:"paystack",children:"Paystack"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"startDate",className:"block text-sm font-medium text-gray-700",children:"Start Date"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(k,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"date",name:"startDate",id:"startDate",className:"focus:ring-orange-500 focus:border-orange-500 block w-full pl-10 sm:text-sm border-gray-300 rounded-md",value:l,onChange:F})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"endDate",className:"block text-sm font-medium text-gray-700",children:"End Date"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(k,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"date",name:"endDate",id:"endDate",className:"focus:ring-orange-500 focus:border-orange-500 block w-full pl-10 sm:text-sm border-gray-300 rounded-md",value:x,onChange:O})]})]})]})})}),e.jsxs("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:[b&&v.length>0&&e.jsx("div",{className:"px-4 py-2 bg-gray-50 border-b border-gray-200",children:e.jsxs("div",{className:"flex justify-center",children:[e.jsx(P,{size:"sm"}),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:"Refreshing data..."})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Order"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Payment"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:v.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No orders found matching your criteria"})}):v.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-orange-100 flex items-center justify-center",children:e.jsx(q,{className:"h-5 w-5 text-orange-600"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.orderNumber}),e.jsxs("div",{className:"text-xs text-gray-500",children:[t.items.length," item(s)"]})]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:t.customer.name}),e.jsx("div",{className:"text-sm text-gray-500",children:t.customer.email}),e.jsx("div",{className:"text-xs text-gray-500",children:t.customer.phone})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:B(t.createdAt)}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(t.createdAt).toLocaleTimeString()})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${U(t.status)}`,children:t.status?t.status.charAt(0).toUpperCase()+t.status.slice(1):"Unknown"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${z(t.paymentStatus)}`,children:t.paymentStatus?t.paymentStatus.charAt(0).toUpperCase()+t.paymentStatus.slice(1):"Unknown"}),e.jsx("span",{className:"text-xs text-gray-500 mt-1",children:I(t.paymentMethod)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:G(t.totalAmount)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsx(H,{to:`/admin/orders/${t._id}`,className:"text-orange-600 hover:text-orange-900",children:e.jsx(J,{className:"h-5 w-5"})})})]},t._id))})]})}),o.totalPages>1&&e.jsx("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6",children:e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing ",e.jsx("span",{className:"font-medium",children:(a-1)*f+1})," to ",e.jsx("span",{className:"font-medium",children:Math.min(a*f,o.total)})," of"," ",e.jsx("span",{className:"font-medium",children:o.total})," results"]})}),e.jsx("div",{children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[e.jsxs("button",{onClick:L,disabled:a===1,className:`relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium ${a===1?"text-gray-300 cursor-not-allowed":"text-gray-500 hover:bg-gray-50"}`,children:[e.jsx("span",{className:"sr-only",children:"Previous"}),e.jsx(K,{className:"h-5 w-5","aria-hidden":"true"})]}),Array.from({length:o.totalPages},(t,c)=>c+1).map(t=>e.jsx("button",{onClick:()=>i(t),className:`relative inline-flex items-center px-4 py-2 border ${t===a?"z-10 bg-orange-50 border-orange-500 text-orange-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"} text-sm font-medium`,children:t},t)),e.jsxs("button",{onClick:$,disabled:a===o.totalPages,className:`relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium ${a===o.totalPages?"text-gray-300 cursor-not-allowed":"text-gray-500 hover:bg-gray-50"}`,children:[e.jsx("span",{className:"sr-only",children:"Next"}),e.jsx(Q,{className:"h-5 w-5","aria-hidden":"true"})]})]})})]})})]})]})})};export{Y as default};
